(()=>{var e={6489:e=>{"use strict";e.exports={mask:(e,t,s,r,i)=>{for(var n=0;n<i;n++)s[r+n]=e[n]^t[3&n]},unmask:(e,t)=>{const s=e.length;for(var r=0;r<s;r++)e[r]^=t[3&r]}}},2627:(e,t,s)=>{"use strict";try{e.exports=s(8169)(__dirname)}catch(t){e.exports=s(6489)}},8169:(e,t,s)=>{const r=require;"function"==typeof r.addon?e.exports=r.addon.bind(r):e.exports=s(1381)},1381:(e,t,s)=>{var r=s(9896),i=s(6928),n=s(857),o=require,a=process.config&&process.config.variables||{},c=!!process.env.PREBUILDS_ONLY,l=process.versions.modules,u=!(!process.versions||!process.versions.electron)||!!process.env.ELECTRON_RUN_AS_NODE||"undefined"!=typeof window&&window.process&&"renderer"===window.process.type?"electron":process.versions&&process.versions.nw?"node-webkit":"node",d=process.env.npm_config_arch||n.arch(),h=process.env.npm_config_platform||n.platform(),f=process.env.LIBC||(function(e){return"linux"===e&&r.existsSync("/etc/alpine-release")}(h)?"musl":"glibc"),p=process.env.ARM_VERSION||("arm64"===d?"8":a.arm_version)||"",g=(process.versions.uv||"").split(".")[0];function m(e){return o(m.resolve(e))}function _(e){try{return r.readdirSync(e)}catch(e){return[]}}function v(e,t){var s=_(e).filter(t);return s[0]&&i.join(e,s[0])}function y(e){return/\.node$/.test(e)}function b(e){var t=e.split("-");if(2===t.length){var s=t[0],r=t[1].split("+");if(s&&r.length&&r.every(Boolean))return{name:e,platform:s,architectures:r}}}function S(e,t){return function(s){return null!=s&&(s.platform===e&&s.architectures.includes(t))}}function w(e,t){return e.architectures.length-t.architectures.length}function E(e){var t=e.split("."),s={file:e,specificity:0};if("node"===t.pop()){for(var r=0;r<t.length;r++){var i=t[r];if("node"===i||"electron"===i||"node-webkit"===i)s.runtime=i;else if("napi"===i)s.napi=!0;else if("abi"===i.slice(0,3))s.abi=i.slice(3);else if("uv"===i.slice(0,2))s.uv=i.slice(2);else if("armv"===i.slice(0,4))s.armv=i.slice(4);else{if("glibc"!==i&&"musl"!==i)continue;s.libc=i}s.specificity++}return s}}function k(e,t){return function(s){return null!=s&&(!(s.runtime&&s.runtime!==e&&!function(e){return"node"===e.runtime&&e.napi}(s))&&(!(s.abi&&s.abi!==t&&!s.napi)&&((!s.uv||s.uv===g)&&((!s.armv||s.armv===p)&&(!s.libc||s.libc===f)))))}}function x(e){return function(t,s){return t.runtime!==s.runtime?t.runtime===e?-1:1:t.abi!==s.abi?t.abi?-1:1:t.specificity!==s.specificity?t.specificity>s.specificity?-1:1:0}}e.exports=m,m.resolve=m.path=function(e){e=i.resolve(e||".");try{var t=o(i.join(e,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[t+"_PREBUILD"]&&(e=process.env[t+"_PREBUILD"])}catch(e){}if(!c){var s=v(i.join(e,"build/Release"),y);if(s)return s;var r=v(i.join(e,"build/Debug"),y);if(r)return r}var n=C(e);if(n)return n;var a=C(i.dirname(process.execPath));if(a)return a;var m=["platform="+h,"arch="+d,"runtime="+u,"abi="+l,"uv="+g,p?"armv="+p:"","libc="+f,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"","webpack=true"].filter(Boolean).join(" ");throw new Error("No native build was found for "+m+"\n    loaded from: "+e+"\n");function C(e){var t=_(i.join(e,"prebuilds")).map(b).filter(S(h,d)).sort(w)[0];if(t){var s=i.join(e,"prebuilds",t.name),r=_(s).map(E).filter(k(u,l)).sort(x(u))[0];return r?i.join(s,r.file):void 0}}},m.parseTags=E,m.matchTags=k,m.compareTags=x,m.parseTuple=b,m.matchTuple=S,m.compareTuples=w},8156:function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function o(e){try{c(r.next(e))}catch(e){n(e)}}function a(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=s(7699),n=s(5827),o=s(9896),a=s(6928),c=s(857),l={port:11190,path:"/utils",client:{reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3}},u={name:"Template Utils",uid:"onecomme.plugin.template-utils",version:"3.0.0",author:"Soma",url:"http://localhost:11180/plugins/onecomme.plugin.template-utils/index.html",permissions:["filter.comment"],defaultState:{version:"3.0.0",languages:[{lang:"en-US",name:"English (US)"},{lang:"ja",name:"日本語"},{lang:"zh-TW",name:"繁體"},{lang:"zh-CN",name:"简体"}],setting:{defaultLanguage:"en-US",filter:{enableFilter:!1,platformOpt:[{label:"YouTube",value:"youtube",color:"red"},{label:"Twitch",value:"twitch",color:"deep-purple"},{label:"Bilibili",value:"bilibili",color:"light-blue"}],platform:[],replaceText:"〇",replaceTarget:[]},datetime:{isAutoTimezone:!0,timeZone:null}},preset:[],presetData:[]},settingMap:new Map,socketConfigMap:new Map,langOptionMap:new Map,langUiPackMap:new Map,templatesMap:new Map,presetsMap:new Map,presetDataMap:new Map,counterContent:new Map,server:void 0,connections:new Set,clients:new Map,init(e,t){return r(this,arguments,void 0,(function*({dir:e,store:t},s){this.store=t,this.getSettingStoreData(),this.verifyVersionStoreData(),this.socketConfigMap.set("default",l),yield this.getSocketPort(),this.getLangOptionStoreData(),this.getPresetStoreData(),this.getPresetDataStoreData(),this.counterContent.set("ohayou1",{counter1isEnable:!1,counter1:0,target1:0,counter1Keywords:[],counter1Users:new Set}),this.counterContent.set("ohayou2",{counter2isEnable:!1,counter2:0,target2:0,counter2Keywords:[],counter2Users:new Set}),this.counterContent.set("ohayou3",{counter3isEnable:!1,counter3:0,target3:0,counter3Keywords:[],counter3Users:new Set}),this.socketServer()}))},filterComment(e,t,s){return r(this,void 0,void 0,(function*(){var t,s,r,i;const n=this.getSettingStoreData()||{},o=(null===(t=n.filter)||void 0===t?void 0:t.platform)||[],a=this.counterContent.get("ohayou1")||{},c=this.counterContent.get("ohayou2")||{},l=this.counterContent.get("ohayou3")||{},u=e.data.comment||"",d=e.data.userId,h=e.data.isFirstTime||!1;if(!0===a.counter1isEnable&&Array.isArray(a.counter1Keywords)){let e=a.counter1||0;const t=a.counter1Users||new Set;(a.counter1Keywords||[]).some((e=>u.includes(e)))&&t instanceof Set&&!t.has(d)&&(e++,t.add(d),a.counter1=e,a.counter1Users=t,this.counterContent.set("ohayou1",a),this.messageHandler())}if(!0===c.counter2isEnable&&Array.isArray(c.counter2Keywords)){let e=c.counter2||0;const t=c.counter2Users||new Set;(c.counter2Keywords||[]).some((e=>u.includes(e)))&&t instanceof Set&&!t.has(d)&&(e++,t.add(d),c.counter2=e,c.counter2Users=t,this.counterContent.set("ohayou2",c),this.messageHandler())}if(!0===l.counter3isEnable&&!0===h){let e=l.counter3||0;const t=l.counter3Users||new Set;!0===h&&t instanceof Set&&!t.has(d)&&(e++,t.add(d),l.counter3=e,l.counter3Users=t,this.counterContent.set("ohayou3",l),this.messageHandler())}if(!0===(null===(s=n.filter)||void 0===s?void 0:s.enableFilter)&&Array.isArray(o)&&o.includes(e.service)){const t=this.nextFilter(e);t&&(e=t)}if("youtube"!==e.service&&"twitch"!==e.service&&"bilibili"!==e.service||(e.customStyle=1),"youtube"==e.service){if("milestonechat"===e.data.giftType&&""===(null===(r=e.data.membership)||void 0===r?void 0:r.primary)&&(e.data.giftType="members",e.data.comment=null===(i=e.data.membership)||void 0===i?void 0:i.sub),"sponsorgift"==e.data.giftType){var f=e.data.comment.match(/\d+/),p=f?parseInt(f[0]):0;e.data.giftCount=p}"superchat"!==e.data.giftType&&"supersticker"!==e.data.giftType&&"milestonechat"!==e.data.giftType&&"members"!==e.data.giftType||(""===e.data.comment?e.data.isNoComment=!0:e.data.isNoComment=!1)}if("twitch"==e.service){if(e.data.isMember="1"==e.data.subscriber,1==e.data.hasGift){let t={};if(e.data.origin){e.data.origin.split(";").forEach((e=>{let[s,r]=e.split(/=(.*)/);r&&(r=r.replace(/\\s/g," ")),t[s]=r})),e.data.originObject=t}if(t){let s=null,r=null,i=null,n=null,o=null;var g;(g=t["msg-id"])&&("submysterygift"==g?(r="sponsorgift",i=t["msg-param-mass-gift-count"]):"subgift"==g?(r="giftreceived",s=t["msg-param-recipient-display-name"]):("sub"==g||"resub"==g)&&(r="members",n=t["msg-param-multimonth-duration"],o=t["msg-param-cumulative-months"]),r&&(e.data.giftType=r),s&&(e.data.recipientDisplayName=s),i&&(e.data.giftCount=Number(i)),n&&(e.data.subscribeCount=Number(n)),o&&(e.data.subscribeCumulative=Number(o)));let a=e.data.bits?parseInt(e.data.bits,10):0;a>0&&(e.data.hasReward=!0,e.data.giftType="reward",e.data.reward_isBits=!0,e.data.reward_price=a)}}if(e.data.reward)if(e.data.hasReward=!0,e.data.giftType="reward",e.data.reward.reward_type){e.data.reward_isBits="BITS"==e.data.reward.pricing_type;let t=e.data.reward.default_bits_cost?e.data.reward.default_bits_cost:0;e.data.reward_price=t}else e.data.reward_isBits=!1,e.data.reward_price=e.data.reward.cost}if("bilibili"==e.service){let t=!1,s=null,r=null;if(1==e.data.hasGift){let r=null;if(e.data.giftData){r="sponsorgift";let i=!1,n=null,o=null,a=null,c=null,l=null,u=null,d=null,h=null;e.data.giftData.blind_gift?(i=!0,n=e.data.giftData.action,o=e.data.giftData.blind_gift.gift_action,a=e.data.giftData.blind_gift.original_gift_name,c=e.data.giftData.giftName,l=e.data.giftData.num,u=e.data.giftData.gift_info.gif,d=e.data.giftData.gift_info.img_basic,h=e.data.giftData.gift_info.webp,e.data.comment=`<span>${n} ${a} ${o}<img class="gift-image" src="${u}" alt="${c}">${c} ✖ ${l}</span>`):(i=!1,n=e.data.giftData.action,c=e.data.giftData.giftName,l=e.data.giftData.num,u=e.data.giftData.gift_info.gif,d=e.data.giftData.gift_info.img_basic,h=e.data.giftData.gift_info.webp,e.data.comment=`<span>${n}<img class="gift-image" src="${u}" alt="${c}">${c} ✖ ${l}</span>`),"silver"!=e.data.giftData.coin_type&&e.data.giftData.price>=100&&(e.data.price=l>0?e.data.giftData.price*l:e.data.giftData.price);let f={is_blindGift:i,action_1:n,action_2:o,blind_giftName:a,giftName:c,giftCount:l,gifImage_gif:u,gifImage_png:d,gifImage_webp:h};if(e.data.giftInfo=f,e.data.price){let t=e.data.price&&e.data.price>99?Number((e.data.price/1e3).toFixed(2)):0;e.data.price=t}e.data.giftData.sender_uinfo.medal&&(s=e.data.giftData.sender_uinfo.medal,t=!0)}if(e.data.superChatData&&(r="superchat",e.data.superChatData.uinfo&&e.data.superChatData.uinfo.medal&&(s=e.data.superChatData.uinfo.medal,t=!0)),e.data.guard){let t=null,s=null;r="members","舰长"==e.data.guard.name&&(s="captain",t="https://i0.hdslb.com/bfs/live/143f5ec3003b4080d1b5f817a9efdca46d631945.png"),"提督"==e.data.guard.name&&(s="admiral",t="https://i0.hdslb.com/bfs/live/1d16bf0fcc3b1b768d1179d60f1fdbabe6ab4489.png"),"总督"==e.data.guard.name&&(s="governor",t="https://i0.hdslb.com/bfs/live/98a201c14a64e860a758f089144dcf3f42e7038c.png"),e.data.memberType=null!=s?s:"default",e.data.guard.iconUrl=null!=t?t:"default",e.data.comment=`<img class="gift-image" src="${t}" alt="${e.data.guard.name}">${e.data.guard.name}`}e.data.giftType=r}else{if(e.data.infoData){let i=null,n=null;e.data.infoData.forEach((e=>{Array.isArray(e)&&e.forEach((e=>{e.user&&e.user.medal&&(i=e.user.medal),e.extra&&(n=e.extra)}))})),i&&(s=i,t=!0),n&&(r=JSON.parse(n))}if(e.data.origin){const t=e.data.origin;if(Array.isArray(t)){let e=null;t.forEach((t=>{Array.isArray(t)&&t.forEach((t=>{t.extra&&(e=t.extra)}))})),e&&(r=JSON.parse(e))}}}1==t&&(e.data.isFans=!0,e.data.medal=s),e.data.medal&&(e.data.isFans=!0,""===e.data.medal.guard_icon&&(e.data.isMember=!1)),r&&(e.data.extraData=r,1==r.dm_type&&(e.data.sticker=r.content))}if(e.data.timestamp&&!isNaN(new Date(e.data.timestamp).getTime())){let t=new Date(e.data.timestamp),s=t.getHours(),r=String(t.getMinutes()).padStart(2,"0"),i=String(t.getSeconds()).padStart(2,"0"),n=s>=12?"PM":"AM",o=s%12;o=o||12;let a=String(o).padStart(2,"0");e.data.timeFull=`${s}:${r}:${i}`,e.data.timeShort=`${a}:${r} ${n}`}return e}))},nextFilter(e){const t=this.settingMap.get("setting")||[];if(t.filter&&t.filter.replaceTarget){const s=t.filter.replaceText||"〇",r=t.filter.replaceTarget;let i=e.data.displayName,n=e.data.comment,o=i||"",a=n.replace(/<img.*?>/g,"");const c=n;let l=0,u=0,d=0,h=0;if(r.forEach((e=>{var t,r=/^\d+$/.test(e),i=/^[a-zA-Z]+$/.test(e);t=1==r||1==i?e:e.split("").join(".*");var n=new RegExp(t,"g");let f=o.match(n),p=a.match(n);if(d=f?f.length:0,h=p?p.length:0,d>0){var g=new RegExp(`[${e}]`,"g");o=o.replace(g,s),l++}if(h>0){g=new RegExp(`[${e}]`,"g");a=c.replace(g,s),u++}})),l>0&&(e.data.comment=a,e.data.displayName="*****"),u>0&&(e.data.comment=a),l>0||u>0)return e}return e},socketServer(){const e=this.socketConfigMap.get("default")||l;this.server=new i.WebSocketServer({port:e.port,path:e.path}),this.server.on("connection",((e,t)=>{const s=(0,n.v4)(),r=new URL(t.url,`ws://${t.headers.host}`).searchParams.get("p");let i=[];r&&(i=r.split(",").map((e=>e.trim())));const o={id:s,socket:e,connectedAt:new Date,lastActivity:new Date,ip:t.socket.remoteAddress,userAgent:t.headers["user-agent"],request:i};this.connections.add(e),this.clients.set(s,o),e.send(JSON.stringify({type:"connected",data:{clientId:s,message:"Connected to Template Utils",timestamp:new Date}})),this.broadcastMessage({type:"client-connected",data:{clientId:s,timestamp:new Date,totalClients:this.connections.size}},e),e.on("message",(t=>{o.lastActivity=new Date;try{const s=JSON.parse(t);"client-info"===s.type&&s.data&&Object.assign(o,s.data),this.broadcastMessage(s,e)}catch(s){this.broadcastMessage(t,e)}})),e.on("close",(()=>{this.connections.delete(e),this.clients.delete(s),this.broadcastMessage({type:"client-disconnected",data:{clientId:s,timestamp:new Date,totalClients:this.connections.size}})})),e.on("error",(e=>{}))})),this.server.on("error",(e=>{})),this.startHeartbeat()},broadcastMessage(e,t=null){const s="string"==typeof e?e:JSON.stringify(e);this.connections.forEach((e=>{e!==t&&1===e.readyState&&e.send(s)}))},sendToClient(e,t,s){const r=this.clients.get(e);if(!r||1!==r.socket.readyState)return!1;try{return r.socket.send(JSON.stringify({type:t,data:s})),r.lastActivity=new Date,!0}catch(e){return!1}},startHeartbeat(){this.heartbeatInterval=setInterval((()=>{const e=new Date;this.clients.forEach(((t,s)=>{if(e.getTime()-t.lastActivity.getTime()>3e5)t.socket.terminate(),this.connections.delete(t.socket),this.clients.delete(s);else if(1===t.socket.readyState)if(t.request&&t.request.length>0){let r={};if(t.request.includes("counter")&&t.request.includes("counter1")){const e=this.counterContent.get("ohayou1")||{};if(!0===e.counter1isEnable){const t=e.counter1||0,s=e.target1||0;r.counter1=t,r.target1=s}}if(t.request.includes("counter")&&t.request.includes("counter2")){const e=this.counterContent.get("ohayou2")||{};if(!0===e.counter2isEnable){const t=e.counter2||0,s=e.target2||0;r.counter2=t,r.target2=s}}if(t.request.includes("counter")&&t.request.includes("counter3")){const e=this.counterContent.get("ohayou3")||{};if(!0===e.counter3isEnable){const t=e.counter3||0,s=e.target3||0;r.counter3=t,r.target3=s}}r&&Object.keys(r).length>0?(r.timestamp=e.toISOString(),this.sendToClient(s,"ping",r)):this.sendToClient(s,"ping",{timestamp:(new Date).toISOString()})}else this.sendToClient(s,"ping",{timestamp:(new Date).toISOString()})}))}),5e3)},messageHandler(){const e=new Date;this.clients.forEach(((t,s)=>{if(t.request&&t.request.length>0){let r={};if(t.request.includes("counter")&&t.request.includes("counter1")){const e=this.counterContent.get("ohayou1")||{};if(!0===e.counter1isEnable){const t=e.counter1||0,s=e.target1||0;r.counter1=t,r.target1=s}}if(t.request.includes("counter")&&t.request.includes("counter2")){const e=this.counterContent.get("ohayou2")||{};if(!0===e.counter2isEnable){const t=e.counter2||0,s=e.target2||0;r.counter2=t,r.target2=s}}if(t.request.includes("counter")&&t.request.includes("counter3")){const e=this.counterContent.get("ohayou3")||{};if(!0===e.counter3isEnable){const t=e.counter3||0,s=e.target3||0;r.counter3=t,r.target3=s}}r&&Object.keys(r).length>0&&(r.timestamp=e.toISOString(),this.sendToClient(s,"update",r))}}))},resetOhayouCounterSetting(e){if("ohayou1"===e){const e=this.counterContent.get("ohayou1")||{};return e.counter1=0,e.counter1Users=new Set,this.counterContent.set("ohayou1",e),this.messageHandler(),!0}if("ohayou2"===e){const e=this.counterContent.get("ohayou2")||{};return e.counter2=0,e.counter2Users=new Set,this.counterContent.set("ohayou2",e),this.messageHandler(),!0}if("ohayou3"===e){const e=this.counterContent.get("ohayou3")||{};return e.counter3=0,e.counter3Users=new Set,this.counterContent.set("ohayou3",e),this.messageHandler(),!0}return!1},updateOhayouCounter(e,t,s,r){if("ohayou1"===e){const e=this.counterContent.get("ohayou1")||{};return r.includes("current")&&(e.counter1=t),r.includes("target")&&(e.target1=s),this.counterContent.set("ohayou1",e),this.messageHandler(),!0}if("ohayou2"===e){const e=this.counterContent.get("ohayou2")||{};return r.includes("current")&&(e.counter2=t),r.includes("target")&&(e.target2=s),this.counterContent.set("ohayou2",e),this.messageHandler(),!0}if("ohayou3"===e){const e=this.counterContent.get("ohayou3")||{};return r.includes("current")&&(e.counter3=t),r.includes("target")&&(e.target3=s),this.counterContent.set("ohayou3",e),this.messageHandler(),!0}return!1},statusOhayouCounter(e,t,s,r){const i=1==t;if("ohayou1"===e){const e=this.counterContent.get("ohayou1")||{};return e.counter1isEnable=i,e.target1=s,e.counter1Keywords=r||[],this.counterContent.set("ohayou1",e),this.messageHandler(),!0}if("ohayou2"===e){const e=this.counterContent.get("ohayou2")||{};return e.counter2isEnable=i,e.target2=s,e.counter2Keywords=r||[],this.counterContent.set("ohayou2",e),this.messageHandler(),!0}if("ohayou3"===e){const e=this.counterContent.get("ohayou3")||{};return e.counter3isEnable=i,e.target3=s,e.counter3Keywords=r||[],this.counterContent.set("ohayou3",e),this.messageHandler(),!0}return!1},request(e){return r(this,void 0,void 0,(function*(){switch(e.method){case"GET":const t="true"===e.params.host,s="true"===e.params.plugin,r="true"===e.params.services,i="true"===e.params.lang,n="true"===e.params.setting,o="true"===e.params.datetime,a="true"===e.params.template,c="true"===e.params.port,l=e.params.presetId,u=l&&!isNaN(parseInt(l,10))?parseInt(l,10):0,d=e.params.templateId||"",h=e.params.code,f="0"===e.params.isCustom;let p={};if(t&&(p.host=this.getHostIP()),s&&(p.pluginVersion=this.version,p.pluginAuthor=this.author,p.appInfo=yield this.getAppInfo()),r&&(p.services=yield this.getAllServices()),n&&(p.setting=this.getSetting()),c){const e=this.socketConfigMap.get("default")||{};p.port=e.port?e.port:null}if(o&&(p.datetime=this.getSettingDatetime()),i&&(p.languageOption=this.getLanguageOption(),p.uipackage=yield this.getUiPack()),a&&(p.templateOption=yield this.getTemplates()),u&&h&&d){const e=yield this.getPresetMappingbyId(u,d,h,f);p.preset=e||[]}return{code:200,response:{data:p}};case"POST":try{const t="string"==typeof e.body?JSON.parse(e.body):e.body;if("preset-status"===t.transmit){const e=t.id;return{code:200,response:yield this.getPresetStatus(e)}}if("preset-load-new"===t.transmit){const e=t.id,s=yield this.loadNewTemplatePreset(e);return!0===s?{code:200,response:s}:{code:400,response:{error:"Invalid JSON payload"}}}if("preset-reload"===t.transmit){const e=t.id,s=yield this.reloadTemplatePreset(e);return!0===s?{code:200,response:s}:{code:400,response:{error:"Invalid JSON payload"}}}if("preset-get"===t.transmit){const e=t.id,s=yield this.getPresetbyTempalateId(e);return s?{code:200,response:s}:{code:400,response:{error:"Invalid JSON payload"}}}if("preset-get-css"===t.transmit){const e=t.templateId,s=t.presetId,r=t.code,i=t.isOriginal,n=yield this.getPresetData(e,s,r,i);return{code:200,response:{preset:n||{}}}}return{code:200,response:!0}}catch(e){return{code:400,response:{error:"Invalid JSON payload"}}}case"PUT":{const t="string"==typeof e.body?JSON.parse(e.body):e.body;if("save-preset"===t.transmit){const e=this.savePresetsData(t);return e.status?{code:200,response:e}:{code:400,response:t}}if("change-language"===t.transmit){const e={defaultLanguage:t.lang};let s=[],r=!1;if(this.saveSettingData(e).status){(yield this.loadUiPack())&&(s=yield this.getUiPack(),r=!0);return{code:200,response:{status:r,package:s}}}}if("save-filter-setting"===t.transmit){const e={filter:t.setting.filter};if(this.saveSettingData(e).status){return{code:200,response:{status:!0}}}}if("save-datetime-setting"===t.transmit){const e={datetime:t.setting.datetime};if(this.saveSettingData(e).status){return{code:200,response:{status:!0}}}}if("update-ohayou-counter"===t.transmit){const e=t.counter||"ohayou1",s=t.current||0,r=t.target||0,i=t.flag||[];if(!0===this.updateOhayouCounter(e,s,r,i))return{code:200,response:t}}if("reset-ohayou-counter"===t.transmit){const{counter:e}=t;if(!0===this.resetOhayouCounterSetting(e))return{code:200,response:!0}}if("status-ohayou-counter"===t.transmit){const e=t.counter||"",s=t.target||0,r=t.keyWords||[],i=!!t.status;if(!0===this.statusOhayouCounter(e,i,s,r))return{code:200,response:!0}}return{code:404,response:!1}}case"DELETE":{const t="string"==typeof e.body?JSON.parse(e.body):e.body;return"delete-preset"===t.transmit&&this.removePreset(t),{code:200,response:!0}}}return{code:404,response:{}}}))},getHostIP(){const e=c.networkInterfaces(),t=[];for(const s in e){const r=e[s];if(r)for(const e of r)"IPv4"!==e.family||e.internal||t.push(e.address)}return t},getAppInfo(){return r(this,void 0,void 0,(function*(){try{const e=yield fetch("http://localhost:11180/api/info",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return yield e.json()}catch(e){throw e}}))},getAllServices(){return r(this,void 0,void 0,(function*(){try{const e=yield fetch("http://localhost:11180/api/services",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return yield e.json()}catch(e){throw e}}))},getTemplates(){return r(this,void 0,void 0,(function*(){try{const e=yield this.loadTemplates(),t=[];return e.forEach((e=>{let s="",r=null,i=!1;if("string"==typeof(null==e?void 0:e.description)&&e.description.includes("|")){const t=(null==e?void 0:e.description)||"",[n,o,a]=t.split("|");s=n||"",r=isNaN(parseFloat(o))?0:parseFloat(o),i=!!a}if(!0===i){const i={id:e.id,name:e.name,path:e.path,url:e.url,thumb:e.thumb,pro:e.pro,dir:e.dir,preset:e.preset,author:e.author,link:e.link,description:e.description,type:s,version:r};["Comment","GankDonationOverlay","Widget","Setlist","Concurrent","Counter"].includes(i.type)&&t.push(i)}})),this.templatesMap=t,t}catch(e){return[]}}))},loadTemplates(){return r(this,void 0,void 0,(function*(){try{const e=yield fetch("http://localhost:11180/api/templates?pro=true",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return yield e.json()}catch(e){throw e}}))},getPresetbyTempalateId(e){return r(this,void 0,void 0,(function*(){let t=[],s=[];e&&(t=yield this.getCustomPreset(e),s=yield this.getOriginalPreset(e));const r=[...t,...s];return r.length>0?r:[{templateId:"",name:"",code:"",type:"",isOriginal:!1,indexFile:"",assetFile:"",presetFile:"",cssFile:"",presetId:0,position:0}]}))},getCustomPreset(e){return r(this,void 0,void 0,(function*(){const t=this.presetsMap.get("preset");t||this.getPresetStoreData();let s=[];return t.length>0&&(s=t.filter((t=>t.templateId===e&&!1===t.isOriginal))),s}))},getOriginalPreset(e){return r(this,void 0,void 0,(function*(){const t=yield this.getTemplates();let s="";if(t.length>0){const r=t.find((t=>t.id===e));r&&(s=r.url)}const r=s+"main.json";let i=[];try{const e=yield this.importJson(r);return e.length>0&&(i=e),i}catch(e){return[]}}))},getPresetData(e,t,s,i){return r(this,void 0,void 0,(function*(){let r={};if(r=i?yield this.getOriginalAssetPreset(e,t,s):yield this.getCustomAssetPreset(e,t,s),r){const e=r.assetData||{},t=r.presetData||{},s=e.attribute||[],i=t.dataSet||[];return{name:r.name||"",code:r.code||"",type:r.type||"",isOriginal:r.isOriginal||!1,indexFile:r.indexFile||"",assetFile:r.assetFile||"",presetFile:r.presetFile||"",cssFile:r.cssFile||"",presetId:r.presetId||0,templateId:r.templateId||"",position:r.position||0,section:e.section||[],part:e.part||[],attribute:s||[],language:e.language||[],description:e.description||[],data:i||[]}}}))},getOriginalAssetPreset(e,t,s){return r(this,void 0,void 0,(function*(){const r=yield this.getTemplates();let i="";if(r.length>0){const t=r.find((t=>t.id===e));t&&(i=t.url)}const n=i+"main.json",o=yield this.importJson(n);let a="",c="",l="",u="",d="",h=!1,f="",p="",g=0,m=0,_=[],v=[];if(o.length>0){const e=o.find((e=>e.presetId===t&&e.code===s));a=e.name||"",c=e.assetFile||"",l=e.presetFile||"",u=e.code||"",d=e.type||"",h=e.isOriginal||!1,f=e.indexFile||"",p=e.cssFile||"",g=e.presetId||0,m=e.position||0}if(c){const e=i+c;_=(yield this.importJson(e))||{}}if(l){const e=i+l;v=(yield this.importJson(e))||{}}return{name:a,templateId:e,assetFile:c,presetFile:l,code:u,type:d,isOriginal:h,indexFile:f,cssFile:p,presetId:g,position:m,assetData:_,presetData:v}}))},getCustomAssetPreset(e,t,s){return r(this,void 0,void 0,(function*(){const r=yield this.getTemplates();let i="";if(r.length>0){const t=r.find((t=>t.id===e));t&&(i=t.url)}const n=(yield this.getCustomPreset(e))||[];let o="",a="",c="",l="",u="",d=!1,h="",f="",p=0,g=0,m=[],_=[];if(n.length>0){const e=n.find((e=>e.presetId===t&&e.code===s));o=e.name||"",a=e.assetFile||"",c=e.presetFile||"",l=e.code||"",u=e.type||"",d=e.isOriginal||!1,h=e.indexFile||"",f=e.cssFile||"",p=e.presetId||0,g=e.position||0}if(a){const e=i+a;m=(yield this.importJson(e))||{}}const v=this.presetDataMap.get("presetData")||[];if(v.length>0){const e=v.find((e=>e.presetId===t&&e.parentCode===s));e&&(_=e||{})}return{name:o,templateId:e,assetFile:a,presetFile:c,code:l,type:u,isOriginal:d,indexFile:h,cssFile:f,presetId:p,position:g,assetData:m,presetData:_}}))},getPresetStoreData(){let e=this.store.get("preset")||{preset:[]};return e&&this.presetsMap.set("preset",e),this.presetsMap.get("preset")||[]},getPresetDataStoreData(){let e=this.store.get("presetData")||{presetData:[]};return e&&this.presetDataMap.set("presetData",e),this.presetDataMap.get("presetData")||[]},savePresetsData(e){const t=this.presetsMap.get("preset"),s=this.presetDataMap.get("presetData"),r=t.length>0?Math.max(...t.map((e=>e.presetId)))+1:1,i=t.length>0?Math.max(...t.map((e=>e.position)))+1:0,n=e.position?e.position:i,o=e.prefix||"",a=e.name||"Custom Preset",c=e.assetFile||"",l=e.presetFile||"",u=e.indexFile||"",d=e.cssFile||"",h=e.code||"",f=e.type||"",p=e.isOriginal||!1,g=e.templateId||"",m=e.presetId||r,_=n,v=e.data||[];if("create-preset"===o){const e={name:a,templateId:g,assetFile:c,presetFile:l,indexFile:u,cssFile:d,code:h,type:f,isOriginal:p,presetId:m,position:_},r={parentCode:h,presetId:m,dataSet:v};t.push(e),s.push(r)}else if("update-preset"===o){const e=t.findIndex((e=>e.presetId===m)),r=s.findIndex((e=>e.presetId===m));-1!==e&&(t[e]={name:a,templateId:g,assetFile:c,presetFile:l,indexFile:u,cssFile:d,code:h,type:f,isOriginal:p,presetId:m,position:_}),-1!==r&&(s[r]={parentCode:h,presetId:m,dataSet:v})}try{return this.store.set("preset",t),this.store.set("presetData",s),{status:!0,code:h,isOriginal:p,presetId:m,templateId:g}}catch(e){}return{status:!1,code:h,isOriginal:p,presetId:m,templateId:g}},removePreset(e){const t=this.presetsMap.get("preset"),s=this.presetDataMap.get("presetData"),r=e.presetId||0,i=e.code||"",n=e.templateId||"",o=t.findIndex((e=>e.presetId===r&&e.code===i&&e.templateId===n)),a=s.findIndex((e=>e.presetId===r&&e.parentCode===i));return-1!==o&&-1!==a&&(t.splice(o,1),s.splice(a,1),this.store.set("preset",t),this.store.set("presetData",s),!0)},getPresetMappingbyId(e,t,s,i){return r(this,void 0,void 0,(function*(){const r=yield this.getPresetData(t,e,s,i),n=r.attribute||[],o=r.data||[];let a=[];return n.length>0&&o.length>0&&n.forEach((e=>{var t,s,r,i,n;const c=this.atIndex(e.code,o),l=!!(null==e?void 0:e.isSetCustom),u=!!(null===(t=o[c])||void 0===t?void 0:t.isCustom),d=l===u,h=!!(null==e?void 0:e.isOriginal);let f="",p=-1;h&&(f=(null==e?void 0:e.oriFrom)?e.oriFrom:"",p=this.atIndex(f,o));const g=!(!h||!l||u||-1===p);if(c>-1)switch(e.attribute){case"time":{const t=o[c].value||0,s=o[c].unit||"px",r=g?o[p].value||0:"",i=g?o[p].unit||"px":"",n=`${t}${s}`,l=g?`${r}${i}`:"";a.push({code:e.code,flag:e.flag,cssvar:e.cssvar,value:d?n:l,isCustom:u,data:{value:d?t:r,unit:d?s:i}});break}case"size":case"degree":{const t=o[c].value||0,s=o[c].unit||"px",r=g?o[p].value||0:"",i=g?o[p].unit||"px":"",n=`${t}${s}`,l=g?`${r}${i}`:"";a.push({code:e.code,flag:e.flag,cssvar:e.cssvar,value:d?n:l,isCustom:u,data:{value:d?t:r,unit:d?s:i}});break}case"size-condition":{const t=o[c].value||0,s=o[c].unit||"px",r=o[c].isDefault||!1,i=o[c].defaultValue||"none",n=g?o[p].value||0:"",l=g?o[p].unit||"px":"",h=g&&o[p].isDefault||!1,f=g?o[p].defaultValue||"none":"",m=r?i:`${t}${s}`,_=g?h?f:`${n}${l}`:"";a.push({code:e.code,flag:e.flag,cssvar:e.cssvar,value:d?m:_,isCustom:u,data:{value:d?t:n,unit:d?s:l}});break}case"size-range-condition":{const t=o[c].value||0,l=o[c].range||{min:0,max:0},h=o[c].unit||"px",f=o[c].isDefault||!1,m=o[c].isDefaultMin||!1,_=o[c].isDefaultMax||!1,v=!(!f||m),y=!(!f||_),b=o[c].defaultValue||"none",S=o[c].defaultValueMin||"none",w=o[c].defaultValueMax||"none",E=g?o[p].value||0:"",k=g&&o[p].range||{min:0,max:0},x=g?o[p].unit||"px":"",C=g&&o[p].isDefault||!1,O=g&&o[p].isDefaultMin||!1,T=g&&o[p].isDefaultMax||!1,$=!(!C||O),P=!(!C||T),D=g&&o[p].defaultValue||"none",I=g&&(null===(r=null===(s=o[p])||void 0===s?void 0:s.range)||void 0===r?void 0:r.min)||"none",N=g&&(null===(n=null===(i=o[p])||void 0===i?void 0:i.range)||void 0===n?void 0:n.max)||"none",U=C?D:`${E}${x}`,L=$?`${k.min}${x}`:I,M=P?`${k.max}${x}`:N,F=f?b:`${t}${h}`,R=g?U:"",B=v?`${l.min}${h}`:S,j=g?L:"",A=y?`${l.max}${h}`:w,W=g?M:"";a.push({code:e.code,flag:e.flag,cssvar:`--${e.code}`,value:d?F:R,isCustom:u,data:{isDefault:d?f:C,defaultValue:d?b:D,value:d?t:E,unit:d?h:x}}),a.push({code:e.code,flag:e.flag,cssvar:`--${e.code}-min`,value:d?B:j,isCustom:u,data:{isDefault:d?m:O,defaultValue:d?S:I,value:d?l.min:k.min,unit:d?h:x}}),a.push({code:e.code,flag:e.flag,cssvar:`--${e.code}-max`,value:d?A:W,isCustom:u,data:{isDefault:d?_:T,defaultValue:d?w:N,value:d?l.max:k.max,unit:d?h:x}});break}case"number":case"double":{const t=o[c].value||0,s=g?o[p].value||0:"",r=g?s:t,i=g?s:"";a.push({code:e.code,flag:e.flag,cssvar:e.cssvar,value:d?r:i,isCustom:u,data:{value:d?r:i}});break}case"radius":{const t=o[c].value||[0,0,0,0],s=o[c].unit||"px",r=g?o[p].value:"",i=g?o[p].unit||"px":"",n=Array.isArray(t)?t.map((e=>`${e}${s}`)).join(" "):`${t}${s}`,l=g?Array.isArray(r)?r.map((e=>`${e}${i}`)).join(" "):`${r}${i}`:"";a.push({code:e.code,flag:e.flag,cssvar:e.cssvar,value:d?n:l,isCustom:u,data:{value:d?t:r,unit:d?s:i}});break}case"margin":case"padding":{const t=o[c].value||[0,0,0,0],s=o[c].unit||"px",r=g?o[p].value:"",i=g?o[p].unit||"px":"",n=Array.isArray(t)?t.map((e=>`${e}${s}`)).join(" "):`${t}${s}`,l=g?Array.isArray(r)?r.map((e=>`${e}${i}`)).join(" "):`${r}${i}`:"";a.push({code:e.code,flag:e.flag,cssvar:e.cssvar,value:d?n:l,isCustom:u,data:{value:d?t:r,unit:d?s:i}});break}case"border":case"border-top":case"border-right":case"border-bottom":{const t=o[c].value||0,s=o[c].unit||"px",r=o[c].style||"none",i=o[c].color||"#FFFFFF",n=g?o[p].value:"",l=g?o[p].unit||"px":"",h=g?o[p].style||"none":"",f=g?o[p].color||"#FFFFFF":"";let m=`${t}${s} ${r} ${i}`,_=`${n}${l} ${h} ${f}`;"none"===r&&(m="none"),"none"===h&&(_="none"),a.push({code:e.code,flag:e.flag,cssvar:e.cssvar,value:d?m:_,isCustom:u,data:{value:d?t:n,unit:d?s:l,style:d?r:h,color:d?i:f}});break}case"font":{const t=e.flag,s=!!t.isVisible,r={isVisible:s,isCss:!!t.isCss},i={isVisible:s,isJs:!!t.isJs};let n="",l="",h=0,f=0,m="",_="",v="",y="",b="",S="",w=0,E=0,k="",x="";if(e.cssvarColor){n=o[c].color||"#FFFFFF",l=g?o[p].color||"#FFFFFF":"";const t=`${n}`,s=`${l}`;a.push({code:e.code,flag:r,cssvar:e.cssvarColor,value:d?t:s,isCustom:u})}if(e.cssvarSize){h=o[c].size||0,m=o[c].unit||"px",f=g&&o[p].size||0,_=g&&o[p].unit||"";const t=`${h}${m}`,s=g?`${f}${_}`:"";a.push({code:e.code,flag:r,cssvar:e.cssvarSize,value:d?t:s,isCustom:u})}if(e.cssvarFont){v=o[c].font||"",y=g&&o[p].font||"",b=o[c].type||"",S=g&&o[p].type||"";const t=`${v}`||"",s=g?`${y}`:"",i=g?`${S}`:`${b}`||"None",n=g?`${S}`:"None";let l=t,h=s;"None"!==i&&(l=`${t}, ${i.toLowerCase()}`,h=`${s}, ${n.toLowerCase()}`),a.push({code:e.code,flag:r,cssvar:e.cssvarFont,value:d?l:h,isCustom:u})}if(e.cssvarWeight){w=o[c].weight||0,E=g&&o[p].weight||0;const t=w?`${w}`:"",s=g&&`${E}`||"";a.push({code:e.code,flag:r,cssvar:e.cssvarWeight,value:d?t:s,isCustom:u})}if(e.cssvarStyle){k=o[c].style||"",x=g&&o[p].style||"";const t=k?`${k}`:"",s=g?`${x}`:"";a.push({code:e.code,flag:r,cssvar:e.cssvarStyle,value:d?t:s,isCustom:u})}const C=d?l:n,O=d?y:v,T=d?S:b,$=d?f:h,P=d?_:m,D=d?E:w,I=d?x:k;a.push({code:e.code,flag:i,cssvar:"",value:"",isCustom:u,data:{color:C,font:O,type:T,size:$,unit:P,weight:D,style:I}});break}case"edge":{const t=o[c].edge,s=o[c].unit,r=o[c].value||0,i=g?o[p].edge:"",n=g?o[p].unit:"",l=g&&o[p].value||0,h=`${r}${s}`,f=l?`${l}${n}`:"";a.push({code:e.code,flag:e.flag,cssvar:e.cssvar,value:d?h:f,isCustom:u,data:{value:d?r:l,edge:d?t:i,unit:d?s:n}});break}case"image":{const t=o[c].value||"",s=g&&o[p].value||"",r=`url('${t}')`||"",i=g?`url('${s}')`:"";a.push({code:e.code,flag:e.flag,cssvar:e.cssvar,value:d?r:i,isCustom:u,data:{value:d?t:s}});break}case"content":{const t=o[c].value||"",s=g&&o[p].value||"",r=`'${t}'`||"",i=g?`'${s}'`:"";a.push({code:e.code,flag:e.flag,cssvar:e.cssvar,value:d?r:i,isCustom:u,data:{value:d?r:i}});break}case"text-shadow":{const t=o[c].horizontal||0,s=o[c].vertical||0,r=o[c].blur||0,i=o[c].color||"#FFFFFF",n=o[c].unit||"px",l=o[c].isEffect||!1,h=g&&o[p].horizontal||0,f=g&&o[p].vertical||0,m=g&&o[p].blur||0,_=g?o[p].color||"":"#FFFFFF",v=g&&o[p].unit||"px",y=g&&o[p].isEffect||!1,b=!0===(g?y:l)?`${g?`${h}${v}`:`${t}${n}`} ${g?`${f}${v}`:`${s}${n}`} ${g?`${m}${v}`:`${r}${n}`} ${g?_:i}`:"none",S=d?t:h,w=d?s:f,E=d?r:m,k=d?i:_,x=d?n:v,C=d?l:y;a.push({code:e.code,flag:e.flag,cssvar:e.cssvar,value:d||g?b:"",isCustom:u,data:{horizontal:S,vertical:w,blur:E,color:k,unit:x,isEffect:C}});break}case"box-shadow":{const t=o[c].horizontal||0,s=o[c].vertical||0,r=o[c].blur||0,i=o[c].spread||0,n=o[c].color||"#000000",l=o[c].unit||"px",h=o[c].inset||!1,f=o[c].isEffect||!1,m=g&&o[p].horizontal||0,_=g&&o[p].vertical||0,v=g&&o[p].blur||0,y=g&&o[p].spread||0,b=g&&o[p].color||"#000000",S=g&&o[p].unit||"px",w=g&&o[p].inset||!1,E=g&&o[p].isEffect||!1,k=`${g?`${m}${S}`:`${t}${l}`} ${g?`${_}${S}`:`${s}${l}`} ${g?`${v}${S}`:`${r}${l}`} ${g?`${y}${S}`:`${i}${l}`} ${g?b:n}`,x=(g?E:f)?(g?w:h)?`${k} inset`:k:"none",C=d?t:m,O=d?s:_,T=d?r:v,$=d?i:y,P=d?n:b,D=d?l:S,I=d?w:h,N=d?E:f;a.push({code:e.code,flag:e.flag,cssvar:e.cssvar,value:d||g?x:"",isCustom:u,data:{horizontal:C,vertical:O,blur:T,spread:$,color:P,isInset:I,isEffect:N,unit:D}});break}case"boolean-multoggle":{const t=g?o[p].toggle||[]:o[c].toggle||[];e.toggle.forEach((s=>{const r=t.find((e=>e.code===s.code)).value?s.truevalue:s.falsevalue;a.push({code:s.code,flag:e.flag,cssvar:s.cssvar,value:d||l?r:"",isCustom:u,data:{value:d||l?r:""}})}));break}case"button-toggle":{const t=e.togleOptions,s=g?o[p].value||"":o[c].value||"",r=e.truedefine,i=e.falsedefine;t.forEach((t=>{const n=t.value===s?r:i;a.push({code:t.code,flag:e.flag,cssvar:t.cssvar,value:d||l?n:"",isCustom:u,data:{value:d||l?n:""}})}));break}case"button-toggle-2":{const t=e.togleOptions,s=g?o[p].value:o[c].value;t.forEach((t=>{if(t.value===s){t.paramSet.forEach((t=>{a.push({code:t.code,flag:e.flag,cssvar:`--${t.code}`,value:d||l?t.value:"",isCustom:u,data:{value:d||l?t.value:""}})}))}}));break}case"linear-gradient":{const t=o[c].gradients.map((e=>`linear-gradient(${e.degree}${e.unit}, ${e.color1}, ${e.color2})`)).join(","),s=g?o[p].gradients.map((e=>`linear-gradient(${e.degree}${e.unit}, ${e.color1}, ${e.color2})`)).join(","):"";a.push({code:e.code,flag:e.flag,cssvar:e.cssvar,value:d?t:s,isCustom:u,data:{value:d?t:s}});break}case"linear-gradient-2":{const t=o[c].gradients.map((e=>`${e.color} ${e.stop}${e.unit}`)).join(","),s=`linear-gradient(${o[c].degree}${e.degreeUnit}, ${t})`,r=g?o[c].gradients.map((e=>`${e.color} ${e.stop}${e.unit}`)).join(","):"",i=g?`linear-gradient(${o[c].degree}${e.degreeUnit}, ${r})`:"";a.push({code:e.code,flag:e.flag,cssvar:e.cssvar,value:d?s:i,isCustom:u,data:{value:d?s:i}});break}case"onecomme-counter-current":a.push({code:e.code,flag:e.flag,cssvar:"",value:"",data:{counterIndex:Number(e.counterIndex)||0,counterName:e.counterName,counterType:e.counterType}});break;case"datetime-date-format":case"datetime-weekday-format":case"datetime-time-format":a.push({code:e.code,flag:e.flag,cssvar:"",value:0,data:{value:Number(o[c].value)||1}});break;default:const t=o[c].value||"",l=g&&o[p].value||"";a.push({code:o[c].code,flag:e.flag,cssvar:e.cssvar,value:d?t:l,isCustom:u,data:{value:d?t:l}})}})),a}))},atIndex:(e,t)=>t&&t.length>0?t.findIndex((t=>t.code===e)):-1,importJson(e){return r(this,void 0,void 0,(function*(){try{const t=yield fetch(e);if(!t.ok)throw new Error(`Failed to fetch JSON: ${t.statusText}`);return yield t.json()}catch(e){return!1}}))},getSetting(){const e=this.settingMap.get("setting")||[];return e||this.getSettingStoreData(),e},getSettingDatetime(){const e=this.settingMap.get("setting")||[];e||this.getSettingStoreData();return e.datetime},getSocketCustomPort(){return r(this,void 0,void 0,(function*(){try{const e=a.join(__dirname,"config.json");if(o.existsSync(e)){const t=o.readFileSync(e,"utf-8");if(!t||""===t.trim())return null;return JSON.parse(t)}return null}catch(e){return null}}))},getSocketPort(){return r(this,void 0,void 0,(function*(){const e=yield this.getSocketCustomPort();if(e){const t=e.port?e.port:null,s=this.socketConfigMap.get("default")||{};t&&(s.port=t,this.socketConfigMap.set("default",s))}}))},getLanguageOption(){const e=this.langOptionMap.get("languages");let t=[];return e||this.getSettingStoreData(),t=e,t},verifyVersionStoreData(){const e=this.store.get("version")||{version:[]},t=this.defaultState.version;e!==t&&(this.settingMap.set("version",t),this.store.set("version",t))},getSettingStoreData(){let e=this.store.get("setting")||{setting:[]};return e&&this.settingMap.set("setting",e),this.settingMap.get("setting")||null},saveSettingData(e){let t=this.settingMap.get("setting")||{};t=Object.assign(Object.assign({},t),e);try{return this.settingMap.set("setting",t),this.store.set("setting",t),{status:!0,updatedSetting:t}}catch(e){return{status:!1,updatedSetting:null}}},getLangOptionStoreData(){let e=this.store.get("languages")||{languages:[]};return e&&this.langOptionMap.set("languages",e),this.langOptionMap.get("languages")||null},loadUiPack(){return r(this,void 0,void 0,(function*(){const e=this.settingMap.get("setting")||{};let t="en-US";e.defaultLanguage&&(t=e.defaultLanguage);const s=`http://localhost:11180/plugins/${this.uid}/languages/${t}.json`;let r=!1;const i=yield this.importJson(s);return i?(this.langUiPackMap.set("uipack",i),r=!0):r=!1,r}))},getUiPack(){return r(this,void 0,void 0,(function*(){let e=this.langUiPackMap.get("uipack");if(!e){if(!(yield this.loadUiPack()))return[];e=this.langUiPackMap.get("uipack")}return e}))},destroy(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null),this.connections.forEach((e=>{try{e.terminate()}catch(e){}})),this.connections.clear(),this.clients.clear(),this.server&&(this.server.close(),this.server=void 0)}};e.exports=u},6556:e=>{"use strict";e.exports=function(e){const t=e.length;let s=0;for(;s<t;)if(128&e[s])if(192==(224&e[s])){if(s+1===t||128!=(192&e[s+1])||192==(254&e[s]))return!1;s+=2}else if(224==(240&e[s])){if(s+2>=t||128!=(192&e[s+1])||128!=(192&e[s+2])||224===e[s]&&128==(224&e[s+1])||237===e[s]&&160==(224&e[s+1]))return!1;s+=3}else{if(240!=(248&e[s]))return!1;if(s+3>=t||128!=(192&e[s+1])||128!=(192&e[s+2])||128!=(192&e[s+3])||240===e[s]&&128==(240&e[s+1])||244===e[s]&&e[s+1]>143||e[s]>244)return!1;s+=4}else s++;return!0}},3148:(e,t,s)=>{"use strict";try{e.exports=s(8169)(__dirname)}catch(t){e.exports=s(6556)}},7699:(e,t,s)=>{"use strict";const r=s(1060);r.createWebSocketStream=s(3719),r.Server=s(1722),r.Receiver=s(6286),r.Sender=s(914),r.WebSocket=r,r.WebSocketServer=r.Server,e.exports=r},3338:(e,t,s)=>{"use strict";const{EMPTY_BUFFER:r}=s(2614),i=Buffer[Symbol.species];function n(e,t,s,r,i){for(let n=0;n<i;n++)s[r+n]=e[n]^t[3&n]}function o(e,t){for(let s=0;s<e.length;s++)e[s]^=t[3&s]}if(e.exports={concat:function(e,t){if(0===e.length)return r;if(1===e.length)return e[0];const s=Buffer.allocUnsafe(t);let n=0;for(let t=0;t<e.length;t++){const r=e[t];s.set(r,n),n+=r.length}return n<t?new i(s.buffer,s.byteOffset,n):s},mask:n,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:function e(t){if(e.readOnly=!0,Buffer.isBuffer(t))return t;let s;return t instanceof ArrayBuffer?s=new i(t):ArrayBuffer.isView(t)?s=new i(t.buffer,t.byteOffset,t.byteLength):(s=Buffer.from(t),e.readOnly=!1),s},unmask:o},!process.env.WS_NO_BUFFER_UTIL)try{const t=s(2627);e.exports.mask=function(e,s,r,i,o){o<48?n(e,s,r,i,o):t.mask(e,s,r,i,o)},e.exports.unmask=function(e,s){e.length<32?o(e,s):t.unmask(e,s)}}catch(e){}},2614:e=>{"use strict";const t=["nodebuffer","arraybuffer","fragments"],s="undefined"!=typeof Blob;s&&t.push("blob"),e.exports={BINARY_TYPES:t,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:s,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},597:(e,t,s)=>{"use strict";const{kForOnEventAttribute:r,kListener:i}=s(2614),n=Symbol("kCode"),o=Symbol("kData"),a=Symbol("kError"),c=Symbol("kMessage"),l=Symbol("kReason"),u=Symbol("kTarget"),d=Symbol("kType"),h=Symbol("kWasClean");class f{constructor(e){this[u]=null,this[d]=e}get target(){return this[u]}get type(){return this[d]}}Object.defineProperty(f.prototype,"target",{enumerable:!0}),Object.defineProperty(f.prototype,"type",{enumerable:!0});class p extends f{constructor(e,t={}){super(e),this[n]=void 0===t.code?0:t.code,this[l]=void 0===t.reason?"":t.reason,this[h]=void 0!==t.wasClean&&t.wasClean}get code(){return this[n]}get reason(){return this[l]}get wasClean(){return this[h]}}Object.defineProperty(p.prototype,"code",{enumerable:!0}),Object.defineProperty(p.prototype,"reason",{enumerable:!0}),Object.defineProperty(p.prototype,"wasClean",{enumerable:!0});class g extends f{constructor(e,t={}){super(e),this[a]=void 0===t.error?null:t.error,this[c]=void 0===t.message?"":t.message}get error(){return this[a]}get message(){return this[c]}}Object.defineProperty(g.prototype,"error",{enumerable:!0}),Object.defineProperty(g.prototype,"message",{enumerable:!0});class m extends f{constructor(e,t={}){super(e),this[o]=void 0===t.data?null:t.data}get data(){return this[o]}}Object.defineProperty(m.prototype,"data",{enumerable:!0});const _={addEventListener(e,t,s={}){for(const n of this.listeners(e))if(!s[r]&&n[i]===t&&!n[r])return;let n;if("message"===e)n=function(e,s){const r=new m("message",{data:s?e:e.toString()});r[u]=this,v(t,this,r)};else if("close"===e)n=function(e,s){const r=new p("close",{code:e,reason:s.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});r[u]=this,v(t,this,r)};else if("error"===e)n=function(e){const s=new g("error",{error:e,message:e.message});s[u]=this,v(t,this,s)};else{if("open"!==e)return;n=function(){const e=new f("open");e[u]=this,v(t,this,e)}}n[r]=!!s[r],n[i]=t,s.once?this.once(e,n):this.on(e,n)},removeEventListener(e,t){for(const s of this.listeners(e))if(s[i]===t&&!s[r]){this.removeListener(e,s);break}}};function v(e,t,s){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,s):e.call(t,s)}e.exports={CloseEvent:p,ErrorEvent:g,Event:f,EventTarget:_,MessageEvent:m}},5926:(e,t,s)=>{"use strict";const{tokenChars:r}=s(5880);function i(e,t,s){void 0===e[t]?e[t]=[s]:e[t].push(s)}e.exports={format:function(e){return Object.keys(e).map((t=>{let s=e[t];return Array.isArray(s)||(s=[s]),s.map((e=>[t].concat(Object.keys(e).map((t=>{let s=e[t];return Array.isArray(s)||(s=[s]),s.map((e=>!0===e?t:`${t}=${e}`)).join("; ")}))).join("; "))).join(", ")})).join(", ")},parse:function(e){const t=Object.create(null);let s,n,o=Object.create(null),a=!1,c=!1,l=!1,u=-1,d=-1,h=-1,f=0;for(;f<e.length;f++)if(d=e.charCodeAt(f),void 0===s)if(-1===h&&1===r[d])-1===u&&(u=f);else if(0===f||32!==d&&9!==d){if(59!==d&&44!==d)throw new SyntaxError(`Unexpected character at index ${f}`);{if(-1===u)throw new SyntaxError(`Unexpected character at index ${f}`);-1===h&&(h=f);const r=e.slice(u,h);44===d?(i(t,r,o),o=Object.create(null)):s=r,u=h=-1}}else-1===h&&-1!==u&&(h=f);else if(void 0===n)if(-1===h&&1===r[d])-1===u&&(u=f);else if(32===d||9===d)-1===h&&-1!==u&&(h=f);else if(59===d||44===d){if(-1===u)throw new SyntaxError(`Unexpected character at index ${f}`);-1===h&&(h=f),i(o,e.slice(u,h),!0),44===d&&(i(t,s,o),o=Object.create(null),s=void 0),u=h=-1}else{if(61!==d||-1===u||-1!==h)throw new SyntaxError(`Unexpected character at index ${f}`);n=e.slice(u,f),u=h=-1}else if(c){if(1!==r[d])throw new SyntaxError(`Unexpected character at index ${f}`);-1===u?u=f:a||(a=!0),c=!1}else if(l)if(1===r[d])-1===u&&(u=f);else if(34===d&&-1!==u)l=!1,h=f;else{if(92!==d)throw new SyntaxError(`Unexpected character at index ${f}`);c=!0}else if(34===d&&61===e.charCodeAt(f-1))l=!0;else if(-1===h&&1===r[d])-1===u&&(u=f);else if(-1===u||32!==d&&9!==d){if(59!==d&&44!==d)throw new SyntaxError(`Unexpected character at index ${f}`);{if(-1===u)throw new SyntaxError(`Unexpected character at index ${f}`);-1===h&&(h=f);let r=e.slice(u,h);a&&(r=r.replace(/\\/g,""),a=!1),i(o,n,r),44===d&&(i(t,s,o),o=Object.create(null),s=void 0),n=void 0,u=h=-1}}else-1===h&&(h=f);if(-1===u||l||32===d||9===d)throw new SyntaxError("Unexpected end of input");-1===h&&(h=f);const p=e.slice(u,h);return void 0===s?i(t,p,o):(void 0===n?i(o,p,!0):i(o,n,a?p.replace(/\\/g,""):p),i(t,s,o)),t}}},4759:e=>{"use strict";const t=Symbol("kDone"),s=Symbol("kRun");e.exports=class{constructor(e){this[t]=()=>{this.pending--,this[s]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[s]()}[s](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[t])}}}},2971:(e,t,s)=>{"use strict";const r=s(3106),i=s(3338),n=s(4759),{kStatusCode:o}=s(2614),a=Buffer[Symbol.species],c=Buffer.from([0,0,255,255]),l=Symbol("permessage-deflate"),u=Symbol("total-length"),d=Symbol("callback"),h=Symbol("buffers"),f=Symbol("error");let p;function g(e){this[h].push(e),this[u]+=e.length}function m(e){this[u]+=e.length,this[l]._maxPayload<1||this[u]<=this[l]._maxPayload?this[h].push(e):(this[f]=new RangeError("Max payload size exceeded"),this[f].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[f][o]=1009,this.removeListener("data",m),this.reset())}function _(e){this[l]._inflate=null,this[f]?this[d](this[f]):(e[o]=1007,this[d](e))}e.exports=class{constructor(e,t,s){if(this._maxPayload=0|s,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!p){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;p=new n(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[d];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,s=e.find((e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits)));if(!s)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(s.server_no_context_takeover=!0),t.clientNoContextTakeover&&(s.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(s.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?s.client_max_window_bits=t.clientMaxWindowBits:!0!==s.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete s.client_max_window_bits,s}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach((e=>{Object.keys(e).forEach((t=>{let s=e[t];if(s.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(s=s[0],"client_max_window_bits"===t){if(!0!==s){const e=+s;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${s}`);s=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${s}`)}else if("server_max_window_bits"===t){const e=+s;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${s}`);s=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==s)throw new TypeError(`Invalid value for parameter "${t}": ${s}`)}e[t]=s}))})),e}decompress(e,t,s){p.add((r=>{this._decompress(e,t,((e,t)=>{r(),s(e,t)}))}))}compress(e,t,s){p.add((r=>{this._compress(e,t,((e,t)=>{r(),s(e,t)}))}))}_decompress(e,t,s){const n=this._isServer?"client":"server";if(!this._inflate){const e=`${n}_max_window_bits`,t="number"!=typeof this.params[e]?r.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=r.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[l]=this,this._inflate[u]=0,this._inflate[h]=[],this._inflate.on("error",_),this._inflate.on("data",m)}this._inflate[d]=s,this._inflate.write(e),t&&this._inflate.write(c),this._inflate.flush((()=>{const e=this._inflate[f];if(e)return this._inflate.close(),this._inflate=null,void s(e);const r=i.concat(this._inflate[h],this._inflate[u]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[u]=0,this._inflate[h]=[],t&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),s(null,r)}))}_compress(e,t,s){const n=this._isServer?"server":"client";if(!this._deflate){const e=`${n}_max_window_bits`,t="number"!=typeof this.params[e]?r.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=r.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[u]=0,this._deflate[h]=[],this._deflate.on("data",g)}this._deflate[d]=s,this._deflate.write(e),this._deflate.flush(r.Z_SYNC_FLUSH,(()=>{if(!this._deflate)return;let e=i.concat(this._deflate[h],this._deflate[u]);t&&(e=new a(e.buffer,e.byteOffset,e.length-4)),this._deflate[d]=null,this._deflate[u]=0,this._deflate[h]=[],t&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),s(null,e)}))}}},6286:(e,t,s)=>{"use strict";const{Writable:r}=s(2203),i=s(2971),{BINARY_TYPES:n,EMPTY_BUFFER:o,kStatusCode:a,kWebSocket:c}=s(2614),{concat:l,toArrayBuffer:u,unmask:d}=s(3338),{isValidStatusCode:h,isValidUTF8:f}=s(5880),p=Buffer[Symbol.species];e.exports=class extends r{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||n[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[c]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,s){if(8===this._opcode&&0==this._state)return s();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(s)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=new p(t.buffer,t.byteOffset+e,t.length-e),new p(t.buffer,t.byteOffset,e)}const t=Buffer.allocUnsafe(e);do{const s=this._buffers[0],r=t.length-e;e>=s.length?t.set(this._buffers.shift(),r):(t.set(new Uint8Array(s.buffer,s.byteOffset,e),r),this._buffers[0]=new p(s.buffer,s.byteOffset+e,s.length-e)),e-=s.length}while(e>0);return t}startLoop(e){this._loop=!0;do{switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:return void(this._loop=!1)}}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2)return void(this._loop=!1);const t=this.consume(2);if(48&t[0]){return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"))}const s=!(64&~t[0]);if(!s||this._extensions[i.extensionName]){if(this._fin=!(128&~t[0]),this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(s){return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}if(!this._fragmented){return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"))}this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented){return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"))}this._compressed=s}else{if(!(this._opcode>7&&this._opcode<11)){return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"))}if(!this._fin){return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"))}if(s){return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength){return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=!(128&~t[1]),this._isServer){if(!this._masked){return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}}else if(this._masked){return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"))}126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}else{e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}}getPayloadLength16(e){this._bufferedBytes<2?this._loop=!1:(this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e))}getPayloadLength64(e){if(this._bufferedBytes<8)return void(this._loop=!1);const t=this.consume(8),s=t.readUInt32BE(0);if(s>Math.pow(2,21)-1){e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH"))}else this._payloadLength=s*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"))}else this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=o;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&d(t,this._mask)}if(this._opcode>7)this.controlMessage(t,e);else{if(this._compressed)return this._state=5,void this.decompress(t,e);t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}}decompress(e,t){this._extensions[i.extensionName].decompress(e,this._fin,((e,s)=>{if(e)return t(e);if(s.length){if(this._messageLength+=s.length,this._messageLength>this._maxPayload&&this._maxPayload>0){const e=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");return void t(e)}this._fragments.push(s)}this.dataMessage(t),0===this._state&&this.startLoop(t)}))}dataMessage(e){if(!this._fin)return void(this._state=0);const t=this._messageLength,s=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let r;r="nodebuffer"===this._binaryType?l(s,t):"arraybuffer"===this._binaryType?u(l(s,t)):"blob"===this._binaryType?new Blob(s):s,this._allowSynchronousEvents?(this.emit("message",r,!0),this._state=0):(this._state=6,setImmediate((()=>{this.emit("message",r,!0),this._state=0,this.startLoop(e)})))}else{const r=l(s,t);if(!this._skipUTF8Validation&&!f(r)){const t=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void e(t)}5===this._state||this._allowSynchronousEvents?(this.emit("message",r,!1),this._state=0):(this._state=6,setImmediate((()=>{this.emit("message",r,!1),this._state=0,this.startLoop(e)})))}}controlMessage(e,t){if(8!==this._opcode)this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate((()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)})));else{if(0===e.length)this._loop=!1,this.emit("conclude",1005,o),this.end();else{const s=e.readUInt16BE(0);if(!h(s)){const e=this.createError(RangeError,`invalid status code ${s}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");return void t(e)}const r=new p(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!f(r)){const e=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void t(e)}this._loop=!1,this.emit("conclude",s,r),this.end()}this._state=0}}createError(e,t,s,r,i){this._loop=!1,this._errored=!0;const n=new e(s?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(n,this.createError),n.code=i,n[a]=r,n}}},914:(e,t,s)=>{"use strict";const{Duplex:r}=s(2203),{randomFillSync:i}=s(6982),n=s(2971),{EMPTY_BUFFER:o,kWebSocket:a,NOOP:c}=s(2614),{isBlob:l,isValidStatusCode:u}=s(5880),{mask:d,toBuffer:h}=s(3338),f=Symbol("kByteLength"),p=Buffer.alloc(4),g=8192;let m,_=g;class v{constructor(e,t,s){this._extensions=t||{},s&&(this._generateMask=s,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=c,this[a]=void 0}static frame(e,t){let s,r,n=!1,o=2,a=!1;t.mask&&(s=t.maskBuffer||p,t.generateMask?t.generateMask(s):(_===g&&(void 0===m&&(m=Buffer.alloc(g)),i(m,0,g),_=0),s[0]=m[_++],s[1]=m[_++],s[2]=m[_++],s[3]=m[_++]),a=!(s[0]|s[1]|s[2]|s[3]),o=6),"string"==typeof e?r=t.mask&&!a||void 0===t[f]?(e=Buffer.from(e)).length:t[f]:(r=e.length,n=t.mask&&t.readOnly&&!a);let c=r;r>=65536?(o+=8,c=127):r>125&&(o+=2,c=126);const l=Buffer.allocUnsafe(n?r+o:o);return l[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(l[0]|=64),l[1]=c,126===c?l.writeUInt16BE(r,2):127===c&&(l[2]=l[3]=0,l.writeUIntBE(r,4,6)),t.mask?(l[1]|=128,l[o-4]=s[0],l[o-3]=s[1],l[o-2]=s[2],l[o-1]=s[3],a?[l,e]:n?(d(e,s,l,o,r),[l]):(d(e,s,e,0,r),[l,e])):[l,e]}close(e,t,s,r){let i;if(void 0===e)i=o;else{if("number"!=typeof e||!u(e))throw new TypeError("First argument must be a valid error code number");if(void 0!==t&&t.length){const s=Buffer.byteLength(t);if(s>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+s),i.writeUInt16BE(e,0),"string"==typeof t?i.write(t,2):i.set(t,2)}else i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0)}const n={[f]:i.length,fin:!0,generateMask:this._generateMask,mask:s,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,i,!1,n,r]):this.sendFrame(v.frame(i,n),r)}ping(e,t,s){let r,i;if("string"==typeof e?(r=Buffer.byteLength(e),i=!1):l(e)?(r=e.size,i=!1):(r=(e=h(e)).length,i=h.readOnly),r>125)throw new RangeError("The data size must not be greater than 125 bytes");const n={[f]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};l(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,n,s]):this.getBlobData(e,!1,n,s):0!==this._state?this.enqueue([this.dispatch,e,!1,n,s]):this.sendFrame(v.frame(e,n),s)}pong(e,t,s){let r,i;if("string"==typeof e?(r=Buffer.byteLength(e),i=!1):l(e)?(r=e.size,i=!1):(r=(e=h(e)).length,i=h.readOnly),r>125)throw new RangeError("The data size must not be greater than 125 bytes");const n={[f]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};l(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,n,s]):this.getBlobData(e,!1,n,s):0!==this._state?this.enqueue([this.dispatch,e,!1,n,s]):this.sendFrame(v.frame(e,n),s)}send(e,t,s){const r=this._extensions[n.extensionName];let i,o,a=t.binary?2:1,c=t.compress;"string"==typeof e?(i=Buffer.byteLength(e),o=!1):l(e)?(i=e.size,o=!1):(i=(e=h(e)).length,o=h.readOnly),this._firstFragment?(this._firstFragment=!1,c&&r&&r.params[r._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(c=i>=r._threshold),this._compress=c):(c=!1,a=0),t.fin&&(this._firstFragment=!0);const u={[f]:i,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:a,readOnly:o,rsv1:c};l(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,u,s]):this.getBlobData(e,this._compress,u,s):0!==this._state?this.enqueue([this.dispatch,e,this._compress,u,s]):this.dispatch(e,this._compress,u,s)}getBlobData(e,t,s,r){this._bufferedBytes+=s[f],this._state=2,e.arrayBuffer().then((e=>{if(this._socket.destroyed){const e=new Error("The socket was closed while the blob was being read");return void process.nextTick(y,this,e,r)}this._bufferedBytes-=s[f];const i=h(e);t?this.dispatch(i,t,s,r):(this._state=0,this.sendFrame(v.frame(i,s),r),this.dequeue())})).catch((e=>{process.nextTick(b,this,e,r)}))}dispatch(e,t,s,r){if(!t)return void this.sendFrame(v.frame(e,s),r);const i=this._extensions[n.extensionName];this._bufferedBytes+=s[f],this._state=1,i.compress(e,s.fin,((e,t)=>{if(this._socket.destroyed){y(this,new Error("The socket was closed while data was being compressed"),r)}else this._bufferedBytes-=s[f],this._state=0,s.readOnly=!1,this.sendFrame(v.frame(t,s),r),this.dequeue()}))}dequeue(){for(;0===this._state&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[3][f],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][f],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function y(e,t,s){"function"==typeof s&&s(t);for(let s=0;s<e._queue.length;s++){const r=e._queue[s],i=r[r.length-1];"function"==typeof i&&i(t)}}function b(e,t,s){y(e,t,s),e.onerror(t)}e.exports=v},3719:(e,t,s)=>{"use strict";s(1060);const{Duplex:r}=s(2203);function i(e){e.emit("close")}function n(){!this.destroyed&&this._writableState.finished&&this.destroy()}function o(e){this.removeListener("error",o),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}e.exports=function(e,t){let s=!0;const a=new r({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",(function(t,s){const r=!s&&a._readableState.objectMode?t.toString():t;a.push(r)||e.pause()})),e.once("error",(function(e){a.destroyed||(s=!1,a.destroy(e))})),e.once("close",(function(){a.destroyed||a.push(null)})),a._destroy=function(t,r){if(e.readyState===e.CLOSED)return r(t),void process.nextTick(i,a);let n=!1;e.once("error",(function(e){n=!0,r(e)})),e.once("close",(function(){n||r(t),process.nextTick(i,a)})),s&&e.terminate()},a._final=function(t){e.readyState!==e.CONNECTING?null!==e._socket&&(e._socket._writableState.finished?(t(),a._readableState.endEmitted&&a.destroy()):(e._socket.once("finish",(function(){t()})),e.close())):e.once("open",(function(){a._final(t)}))},a._read=function(){e.isPaused&&e.resume()},a._write=function(t,s,r){e.readyState!==e.CONNECTING?e.send(t,r):e.once("open",(function(){a._write(t,s,r)}))},a.on("end",n),a.on("error",o),a}},8237:(e,t,s)=>{"use strict";const{tokenChars:r}=s(5880);e.exports={parse:function(e){const t=new Set;let s=-1,i=-1,n=0;for(;n<e.length;n++){const o=e.charCodeAt(n);if(-1===i&&1===r[o])-1===s&&(s=n);else if(0===n||32!==o&&9!==o){if(44!==o)throw new SyntaxError(`Unexpected character at index ${n}`);{if(-1===s)throw new SyntaxError(`Unexpected character at index ${n}`);-1===i&&(i=n);const r=e.slice(s,i);if(t.has(r))throw new SyntaxError(`The "${r}" subprotocol is duplicated`);t.add(r),s=i=-1}}else-1===i&&-1!==s&&(i=n)}if(-1===s||-1!==i)throw new SyntaxError("Unexpected end of input");const o=e.slice(s,n);if(t.has(o))throw new SyntaxError(`The "${o}" subprotocol is duplicated`);return t.add(o),t}}},5880:(e,t,s)=>{"use strict";const{isUtf8:r}=s(181),{hasBlob:i}=s(2614);function n(e){const t=e.length;let s=0;for(;s<t;)if(128&e[s])if(192==(224&e[s])){if(s+1===t||128!=(192&e[s+1])||192==(254&e[s]))return!1;s+=2}else if(224==(240&e[s])){if(s+2>=t||128!=(192&e[s+1])||128!=(192&e[s+2])||224===e[s]&&128==(224&e[s+1])||237===e[s]&&160==(224&e[s+1]))return!1;s+=3}else{if(240!=(248&e[s]))return!1;if(s+3>=t||128!=(192&e[s+1])||128!=(192&e[s+2])||128!=(192&e[s+3])||240===e[s]&&128==(240&e[s+1])||244===e[s]&&e[s+1]>143||e[s]>244)return!1;s+=4}else s++;return!0}if(e.exports={isBlob:function(e){return i&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:n,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},r)e.exports.isValidUTF8=function(e){return e.length<24?n(e):r(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{const t=s(3148);e.exports.isValidUTF8=function(e){return e.length<32?n(e):t(e)}}catch(e){}},1722:(e,t,s)=>{"use strict";const r=s(4434),i=s(8611),{Duplex:n}=s(2203),{createHash:o}=s(6982),a=s(5926),c=s(2971),l=s(8237),u=s(1060),{GUID:d,kWebSocket:h}=s(2614),f=/^[+/0-9A-Za-z]{22}==$/;function p(e){e._state=2,e.emit("close")}function g(){this.destroy()}function m(e,t,s,r){s=s||i.STATUS_CODES[t],r={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(s),...r},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${i.STATUS_CODES[t]}\r\n`+Object.keys(r).map((e=>`${e}: ${r[e]}`)).join("\r\n")+"\r\n\r\n"+s)}function _(e,t,s,r,i){if(e.listenerCount("wsClientError")){const r=new Error(i);Error.captureStackTrace(r,_),e.emit("wsClientError",r,s,t)}else m(s,r,i)}e.exports=class extends r{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:u,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=i.createServer(((e,t)=>{const s=i.STATUS_CODES[426];t.writeHead(426,{"Content-Length":s.length,"Content-Type":"text/plain"}),t.end(s)})),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(const s of Object.keys(t))e.on(s,t[s]);return function(){for(const s of Object.keys(t))e.removeListener(s,t[s])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,s,r)=>{this.handleUpgrade(t,s,r,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state)return e&&this.once("close",(()=>{e(new Error("The server is not running"))})),void process.nextTick(p,this);if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(p,this);else{const e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close((()=>{p(this)}))}}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,s,r){t.on("error",g);const i=e.headers["sec-websocket-key"],n=e.headers.upgrade,o=+e.headers["sec-websocket-version"];if("GET"!==e.method){return void _(this,e,t,405,"Invalid HTTP method")}if(void 0===n||"websocket"!==n.toLowerCase()){return void _(this,e,t,400,"Invalid Upgrade header")}if(void 0===i||!f.test(i)){return void _(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header")}if(8!==o&&13!==o){return void _(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header")}if(!this.shouldHandle(e))return void m(t,400);const u=e.headers["sec-websocket-protocol"];let d=new Set;if(void 0!==u)try{d=l.parse(u)}catch(s){return void _(this,e,t,400,"Invalid Sec-WebSocket-Protocol header")}const h=e.headers["sec-websocket-extensions"],p={};if(this.options.perMessageDeflate&&void 0!==h){const s=new c(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const e=a.parse(h);e[c.extensionName]&&(s.accept(e[c.extensionName]),p[c.extensionName]=s)}catch(s){return void _(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header")}}if(this.options.verifyClient){const n={origin:e.headers[""+(8===o?"sec-websocket-origin":"origin")],secure:!(!e.socket.authorized&&!e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(n,((n,o,a,c)=>{if(!n)return m(t,o||401,a,c);this.completeUpgrade(p,i,d,e,t,s,r)}));if(!this.options.verifyClient(n))return m(t,401)}this.completeUpgrade(p,i,d,e,t,s,r)}completeUpgrade(e,t,s,r,i,n,l){if(!i.readable||!i.writable)return i.destroy();if(i[h])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return m(i,503);const u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${o("sha1").update(t+d).digest("base64")}`],f=new this.options.WebSocket(null,void 0,this.options);if(s.size){const e=this.options.handleProtocols?this.options.handleProtocols(s,r):s.values().next().value;e&&(u.push(`Sec-WebSocket-Protocol: ${e}`),f._protocol=e)}if(e[c.extensionName]){const t=e[c.extensionName].params,s=a.format({[c.extensionName]:[t]});u.push(`Sec-WebSocket-Extensions: ${s}`),f._extensions=e}this.emit("headers",u,r),i.write(u.concat("\r\n").join("\r\n")),i.removeListener("error",g),f.setSocket(i,n,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(f),f.on("close",(()=>{this.clients.delete(f),this._shouldEmitClose&&!this.clients.size&&process.nextTick(p,this)}))),l(f,r)}}},1060:(e,t,s)=>{"use strict";const r=s(4434),i=s(5692),n=s(8611),o=s(9278),a=s(4756),{randomBytes:c,createHash:l}=s(6982),{Duplex:u,Readable:d}=s(2203),{URL:h}=s(7016),f=s(2971),p=s(6286),g=s(914),{isBlob:m}=s(5880),{BINARY_TYPES:_,EMPTY_BUFFER:v,GUID:y,kForOnEventAttribute:b,kListener:S,kStatusCode:w,kWebSocket:E,NOOP:k}=s(2614),{EventTarget:{addEventListener:x,removeEventListener:C}}=s(597),{format:O,parse:T}=s(5926),{toBuffer:$}=s(3338),P=3e4,D=Symbol("kAborted"),I=[8,13],N=["CONNECTING","OPEN","CLOSING","CLOSED"],U=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class L extends r{constructor(e,t,s){super(),this._binaryType=_[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=v,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=L.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(s=t,t=[]):t=[t]),M(this,e,t,s)):(this._autoPong=s.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){_.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,s){const r=new p({allowSynchronousEvents:s.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation}),i=new g(e,this._extensions,s.generateMask);this._receiver=r,this._sender=i,this._socket=e,r[E]=this,i[E]=this,e[E]=this,r.on("conclude",W),r.on("drain",q),r.on("error",V),r.on("message",z),r.on("ping",H),r.on("pong",J),i.onerror=Y,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Z),e.on("data",Q),e.on("end",ee),e.on("error",te),this._readyState=L.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this._readyState=L.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[f.extensionName]&&this._extensions[f.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=L.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==L.CLOSED)if(this.readyState!==L.CONNECTING)this.readyState!==L.CLOSING?(this._readyState=L.CLOSING,this._sender.close(e,t,!this._isServer,(e=>{e||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())})),X(this)):this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();else{const e="WebSocket was closed before the connection was established";j(this,this._req,e)}}pause(){this.readyState!==L.CONNECTING&&this.readyState!==L.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,s){if(this.readyState===L.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(s=e,e=t=void 0):"function"==typeof t&&(s=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===L.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||v,t,s)):A(this,e,s)}pong(e,t,s){if(this.readyState===L.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(s=e,e=t=void 0):"function"==typeof t&&(s=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===L.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||v,t,s)):A(this,e,s)}resume(){this.readyState!==L.CONNECTING&&this.readyState!==L.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,s){if(this.readyState===L.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(s=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==L.OPEN)return void A(this,e,s);const r={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[f.extensionName]||(r.compress=!1),this._sender.send(e||v,r,s)}terminate(){if(this.readyState!==L.CLOSED)if(this.readyState!==L.CONNECTING)this._socket&&(this._readyState=L.CLOSING,this._socket.destroy());else{const e="WebSocket was closed before the connection was established";j(this,this._req,e)}}}function M(e,t,s,r){const o={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:I[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...r,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(e._autoPong=o.autoPong,!I.includes(o.protocolVersion))throw new RangeError(`Unsupported protocol version: ${o.protocolVersion} (supported versions: ${I.join(", ")})`);let a;if(t instanceof h)a=t;else try{a=new h(t)}catch(e){throw new SyntaxError(`Invalid URL: ${t}`)}"http:"===a.protocol?a.protocol="ws:":"https:"===a.protocol&&(a.protocol="wss:"),e._url=a.href;const u="wss:"===a.protocol,d="ws+unix:"===a.protocol;let p;if("ws:"===a.protocol||u||d?d&&!a.pathname?p="The URL's pathname is empty":a.hash&&(p="The URL contains a fragment identifier"):p='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',p){const t=new SyntaxError(p);if(0===e._redirects)throw t;return void F(e,t)}const g=u?443:80,m=c(16).toString("base64"),_=u?i.request:n.request,v=new Set;let b,S;if(o.createConnection=o.createConnection||(u?B:R),o.defaultPort=o.defaultPort||g,o.port=a.port||g,o.host=a.hostname.startsWith("[")?a.hostname.slice(1,-1):a.hostname,o.headers={...o.headers,"Sec-WebSocket-Version":o.protocolVersion,"Sec-WebSocket-Key":m,Connection:"Upgrade",Upgrade:"websocket"},o.path=a.pathname+a.search,o.timeout=o.handshakeTimeout,o.perMessageDeflate&&(b=new f(!0!==o.perMessageDeflate?o.perMessageDeflate:{},!1,o.maxPayload),o.headers["Sec-WebSocket-Extensions"]=O({[f.extensionName]:b.offer()})),s.length){for(const e of s){if("string"!=typeof e||!U.test(e)||v.has(e))throw new SyntaxError("An invalid or duplicated subprotocol was specified");v.add(e)}o.headers["Sec-WebSocket-Protocol"]=s.join(",")}if(o.origin&&(o.protocolVersion<13?o.headers["Sec-WebSocket-Origin"]=o.origin:o.headers.Origin=o.origin),(a.username||a.password)&&(o.auth=`${a.username}:${a.password}`),d){const e=o.path.split(":");o.socketPath=e[0],o.path=e[1]}if(o.followRedirects){if(0===e._redirects){e._originalIpc=d,e._originalSecure=u,e._originalHostOrSocketPath=d?o.socketPath:a.host;const t=r&&r.headers;if(r={...r,headers:{}},t)for(const[e,s]of Object.entries(t))r.headers[e.toLowerCase()]=s}else if(0===e.listenerCount("redirect")){const t=d?!!e._originalIpc&&o.socketPath===e._originalHostOrSocketPath:!e._originalIpc&&a.host===e._originalHostOrSocketPath;(!t||e._originalSecure&&!u)&&(delete o.headers.authorization,delete o.headers.cookie,t||delete o.headers.host,o.auth=void 0)}o.auth&&!r.headers.authorization&&(r.headers.authorization="Basic "+Buffer.from(o.auth).toString("base64")),S=e._req=_(o),e._redirects&&e.emit("redirect",e.url,S)}else S=e._req=_(o);o.timeout&&S.on("timeout",(()=>{j(e,S,"Opening handshake has timed out")})),S.on("error",(t=>{null===S||S[D]||(S=e._req=null,F(e,t))})),S.on("response",(i=>{const n=i.headers.location,a=i.statusCode;if(n&&o.followRedirects&&a>=300&&a<400){if(++e._redirects>o.maxRedirects)return void j(e,S,"Maximum redirects exceeded");let i;S.abort();try{i=new h(n,t)}catch(t){const s=new SyntaxError(`Invalid URL: ${n}`);return void F(e,s)}M(e,i,s,r)}else e.emit("unexpected-response",S,i)||j(e,S,`Unexpected server response: ${i.statusCode}`)})),S.on("upgrade",((t,s,r)=>{if(e.emit("upgrade",t),e.readyState!==L.CONNECTING)return;S=e._req=null;const i=t.headers.upgrade;if(void 0===i||"websocket"!==i.toLowerCase())return void j(e,s,"Invalid Upgrade header");const n=l("sha1").update(m+y).digest("base64");if(t.headers["sec-websocket-accept"]!==n)return void j(e,s,"Invalid Sec-WebSocket-Accept header");const a=t.headers["sec-websocket-protocol"];let c;if(void 0!==a?v.size?v.has(a)||(c="Server sent an invalid subprotocol"):c="Server sent a subprotocol but none was requested":v.size&&(c="Server sent no subprotocol"),c)return void j(e,s,c);a&&(e._protocol=a);const u=t.headers["sec-websocket-extensions"];if(void 0!==u){if(!b){return void j(e,s,"Server sent a Sec-WebSocket-Extensions header but no extension was requested")}let t;try{t=T(u)}catch(t){return void j(e,s,"Invalid Sec-WebSocket-Extensions header")}const r=Object.keys(t);if(1!==r.length||r[0]!==f.extensionName){return void j(e,s,"Server indicated an extension that was not requested")}try{b.accept(t[f.extensionName])}catch(t){return void j(e,s,"Invalid Sec-WebSocket-Extensions header")}e._extensions[f.extensionName]=b}e.setSocket(s,r,{allowSynchronousEvents:o.allowSynchronousEvents,generateMask:o.generateMask,maxPayload:o.maxPayload,skipUTF8Validation:o.skipUTF8Validation})})),o.finishRequest?o.finishRequest(S,e):S.end()}function F(e,t){e._readyState=L.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function R(e){return e.path=e.socketPath,o.connect(e)}function B(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=o.isIP(e.host)?"":e.host),a.connect(e)}function j(e,t,s){e._readyState=L.CLOSING;const r=new Error(s);Error.captureStackTrace(r,j),t.setHeader?(t[D]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(F,e,r)):(t.destroy(r),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function A(e,t,s){if(t){const s=m(t)?t.size:$(t).length;e._socket?e._sender._bufferedBytes+=s:e._bufferedAmount+=s}if(s){const t=new Error(`WebSocket is not open: readyState ${e.readyState} (${N[e.readyState]})`);process.nextTick(s,t)}}function W(e,t){const s=this[E];s._closeFrameReceived=!0,s._closeMessage=t,s._closeCode=e,void 0!==s._socket[E]&&(s._socket.removeListener("data",Q),process.nextTick(K,s._socket),1005===e?s.close():s.close(e,t))}function q(){const e=this[E];e.isPaused||e._socket.resume()}function V(e){const t=this[E];void 0!==t._socket[E]&&(t._socket.removeListener("data",Q),process.nextTick(K,t._socket),t.close(e[w])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function G(){this[E].emitClose()}function z(e,t){this[E].emit("message",e,t)}function H(e){const t=this[E];t._autoPong&&t.pong(e,!this._isServer,k),t.emit("ping",e)}function J(e){this[E].emit("pong",e)}function K(e){e.resume()}function Y(e){const t=this[E];t.readyState!==L.CLOSED&&(t.readyState===L.OPEN&&(t._readyState=L.CLOSING,X(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function X(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),P)}function Z(){const e=this[E];let t;this.removeListener("close",Z),this.removeListener("data",Q),this.removeListener("end",ee),e._readyState=L.CLOSING,this._readableState.endEmitted||e._closeFrameReceived||e._receiver._writableState.errorEmitted||null===(t=e._socket.read())||e._receiver.write(t),e._receiver.end(),this[E]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",G),e._receiver.on("finish",G))}function Q(e){this[E]._receiver.write(e)||this.pause()}function ee(){const e=this[E];e._readyState=L.CLOSING,e._receiver.end(),this.end()}function te(){const e=this[E];this.removeListener("error",te),this.on("error",k),e&&(e._readyState=L.CLOSING,this.destroy())}Object.defineProperty(L,"CONNECTING",{enumerable:!0,value:N.indexOf("CONNECTING")}),Object.defineProperty(L.prototype,"CONNECTING",{enumerable:!0,value:N.indexOf("CONNECTING")}),Object.defineProperty(L,"OPEN",{enumerable:!0,value:N.indexOf("OPEN")}),Object.defineProperty(L.prototype,"OPEN",{enumerable:!0,value:N.indexOf("OPEN")}),Object.defineProperty(L,"CLOSING",{enumerable:!0,value:N.indexOf("CLOSING")}),Object.defineProperty(L.prototype,"CLOSING",{enumerable:!0,value:N.indexOf("CLOSING")}),Object.defineProperty(L,"CLOSED",{enumerable:!0,value:N.indexOf("CLOSED")}),Object.defineProperty(L.prototype,"CLOSED",{enumerable:!0,value:N.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach((e=>{Object.defineProperty(L.prototype,e,{enumerable:!0})})),["open","error","close","message"].forEach((e=>{Object.defineProperty(L.prototype,`on${e}`,{enumerable:!0,get(){for(const t of this.listeners(e))if(t[b])return t[S];return null},set(t){for(const t of this.listeners(e))if(t[b]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[b]:!0})}})})),L.prototype.addEventListener=x,L.prototype.removeEventListener=C,e.exports=L},181:e=>{"use strict";e.exports=require("buffer")},6982:e=>{"use strict";e.exports=require("crypto")},4434:e=>{"use strict";e.exports=require("events")},9896:e=>{"use strict";e.exports=require("fs")},8611:e=>{"use strict";e.exports=require("http")},5692:e=>{"use strict";e.exports=require("https")},9278:e=>{"use strict";e.exports=require("net")},857:e=>{"use strict";e.exports=require("os")},6928:e=>{"use strict";e.exports=require("path")},2203:e=>{"use strict";e.exports=require("stream")},4756:e=>{"use strict";e.exports=require("tls")},7016:e=>{"use strict";e.exports=require("url")},3106:e=>{"use strict";e.exports=require("zlib")},5827:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version=t.validate=t.v7=t.v6ToV1=t.v6=t.v5=t.v4=t.v3=t.v1ToV6=t.v1=t.stringify=t.parse=t.NIL=t.MAX=void 0;var r=s(5609);Object.defineProperty(t,"MAX",{enumerable:!0,get:function(){return r.default}});var i=s(3588);Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return i.default}});var n=s(2524);Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return n.default}});var o=s(3202);Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return o.default}});var a=s(458);Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return a.default}});var c=s(3891);Object.defineProperty(t,"v1ToV6",{enumerable:!0,get:function(){return c.default}});var l=s(32);Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return l.default}});var u=s(8597);Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return u.default}});var d=s(4502);Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return d.default}});var h=s(7971);Object.defineProperty(t,"v6",{enumerable:!0,get:function(){return h.default}});var f=s(8959);Object.defineProperty(t,"v6ToV1",{enumerable:!0,get:function(){return f.default}});var p=s(2508);Object.defineProperty(t,"v7",{enumerable:!0,get:function(){return p.default}});var g=s(8873);Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return g.default}});var m=s(9547);Object.defineProperty(t,"version",{enumerable:!0,get:function(){return m.default}})},5609:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="ffffffff-ffff-ffff-ffff-ffffffffffff"},7355:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(6982);t.default=function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),(0,r.createHash)("md5").update(e).digest()}},1152:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(6982);t.default={randomUUID:r.randomUUID}},3588:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="00000000-0000-0000-0000-000000000000"},2524:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(8873);t.default=function(e){if(!(0,r.default)(e))throw TypeError("Invalid UUID");let t;return Uint8Array.of((t=parseInt(e.slice(0,8),16))>>>24,t>>>16&255,t>>>8&255,255&t,(t=parseInt(e.slice(9,13),16))>>>8,255&t,(t=parseInt(e.slice(14,18),16))>>>8,255&t,(t=parseInt(e.slice(19,23),16))>>>8,255&t,(t=parseInt(e.slice(24,36),16))/1099511627776&255,t/4294967296&255,t>>>24&255,t>>>16&255,t>>>8&255,255&t)}},3596:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i},9942:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(6982),i=new Uint8Array(256);let n=i.length;t.default=function(){return n>i.length-16&&((0,r.randomFillSync)(i),n=0),i.slice(n,n+=16)}},7766:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(6982);t.default=function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),(0,r.createHash)("sha1").update(e).digest()}},3202:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unsafeStringify=void 0;const r=s(8873),i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));function n(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}t.unsafeStringify=n,t.default=function(e,t=0){const s=n(e,t);if(!(0,r.default)(s))throw TypeError("Stringified UUID is invalid");return s}},458:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateV1State=void 0;const r=s(9942),i=s(3202),n={};function o(e,t,s){return e.msecs??=-1/0,e.nsecs??=0,t===e.msecs?(e.nsecs++,e.nsecs>=1e4&&(e.node=void 0,e.nsecs=0)):t>e.msecs?e.nsecs=0:t<e.msecs&&(e.node=void 0),e.node||(e.node=s.slice(10,16),e.node[0]|=1,e.clockseq=16383&(s[8]<<8|s[9])),e.msecs=t,e}function a(e,t,s,r,i,n,o=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(n){if(o<0||o+16>n.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`)}else n=new Uint8Array(16),o=0;t??=Date.now(),s??=0,r??=16383&(e[8]<<8|e[9]),i??=e.slice(10,16);const a=(1e4*(268435455&(t+=122192928e5))+s)%4294967296;n[o++]=a>>>24&255,n[o++]=a>>>16&255,n[o++]=a>>>8&255,n[o++]=255&a;const c=t/4294967296*1e4&268435455;n[o++]=c>>>8&255,n[o++]=255&c,n[o++]=c>>>24&15|16,n[o++]=c>>>16&255,n[o++]=r>>>8|128,n[o++]=255&r;for(let e=0;e<6;++e)n[o++]=i[e];return n}t.updateV1State=o,t.default=function(e,t,s){let c;const l=e?._v6??!1;if(e){const t=Object.keys(e);1===t.length&&"_v6"===t[0]&&(e=void 0)}if(e)c=a(e.random??e.rng?.()??(0,r.default)(),e.msecs,e.nsecs,e.clockseq,e.node,t,s);else{const e=Date.now(),i=(0,r.default)();o(n,e,i),c=a(i,n.msecs,n.nsecs,l?void 0:n.clockseq,l?void 0:n.node,t,s)}return t??(0,i.unsafeStringify)(c)}},3891:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(2524),i=s(3202);t.default=function(e){const t=function(e){return Uint8Array.of((15&e[6])<<4|e[7]>>4&15,(15&e[7])<<4|(240&e[4])>>4,(15&e[4])<<4|(240&e[5])>>4,(15&e[5])<<4|(240&e[0])>>4,(15&e[0])<<4|(240&e[1])>>4,(15&e[1])<<4|(240&e[2])>>4,96|15&e[2],e[3],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}("string"==typeof e?(0,r.default)(e):e);return"string"==typeof e?(0,i.unsafeStringify)(t):t}},32:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0;const r=s(7355),i=s(8157);var n=s(8157);function o(e,t,s,n){return(0,i.default)(48,r.default,e,t,s,n)}Object.defineProperty(t,"DNS",{enumerable:!0,get:function(){return n.DNS}}),Object.defineProperty(t,"URL",{enumerable:!0,get:function(){return n.URL}}),o.DNS=i.DNS,o.URL=i.URL,t.default=o},8157:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=t.stringToBytes=void 0;const r=s(2524),i=s(3202);function n(e){e=unescape(encodeURIComponent(e));const t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t[s]=e.charCodeAt(s);return t}t.stringToBytes=n,t.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",t.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",t.default=function(e,t,s,o,a,c){const l="string"==typeof s?n(s):s,u="string"==typeof o?(0,r.default)(o):o;if("string"==typeof o&&(o=(0,r.default)(o)),16!==o?.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let d=new Uint8Array(16+l.length);if(d.set(u),d.set(l,u.length),d=t(d),d[6]=15&d[6]|e,d[8]=63&d[8]|128,a){c=c||0;for(let e=0;e<16;++e)a[c+e]=d[e];return a}return(0,i.unsafeStringify)(d)}},8597:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1152),i=s(9942),n=s(3202);t.default=function(e,t,s){if(r.default.randomUUID&&!t&&!e)return r.default.randomUUID();const o=(e=e||{}).random??e.rng?.()??(0,i.default)();if(o.length<16)throw new Error("Random bytes length must be >= 16");if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){if((s=s||0)<0||s+16>t.length)throw new RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[s+e]=o[e];return t}return(0,n.unsafeStringify)(o)}},4502:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0;const r=s(7766),i=s(8157);var n=s(8157);function o(e,t,s,n){return(0,i.default)(80,r.default,e,t,s,n)}Object.defineProperty(t,"DNS",{enumerable:!0,get:function(){return n.DNS}}),Object.defineProperty(t,"URL",{enumerable:!0,get:function(){return n.URL}}),o.DNS=i.DNS,o.URL=i.URL,t.default=o},7971:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(3202),i=s(458),n=s(3891);t.default=function(e,t,s){e??={},s??=0;let o=(0,i.default)({...e,_v6:!0},new Uint8Array(16));if(o=(0,n.default)(o),t){for(let e=0;e<16;e++)t[s+e]=o[e];return t}return(0,r.unsafeStringify)(o)}},8959:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(2524),i=s(3202);t.default=function(e){const t=function(e){return Uint8Array.of((15&e[3])<<4|e[4]>>4&15,(15&e[4])<<4|(240&e[5])>>4,(15&e[5])<<4|15&e[6],e[7],(15&e[1])<<4|(240&e[2])>>4,(15&e[2])<<4|(240&e[3])>>4,16|(240&e[0])>>4,(15&e[0])<<4|(240&e[1])>>4,e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}("string"==typeof e?(0,r.default)(e):e);return"string"==typeof e?(0,i.unsafeStringify)(t):t}},2508:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateV7State=void 0;const r=s(9942),i=s(3202),n={};function o(e,t,s){return e.msecs??=-1/0,e.seq??=0,t>e.msecs?(e.seq=s[6]<<23|s[7]<<16|s[8]<<8|s[9],e.msecs=t):(e.seq=e.seq+1|0,0===e.seq&&e.msecs++),e}function a(e,t,s,r,i=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(r){if(i<0||i+16>r.length)throw new RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`)}else r=new Uint8Array(16),i=0;return t??=Date.now(),s??=127*e[6]<<24|e[7]<<16|e[8]<<8|e[9],r[i++]=t/1099511627776&255,r[i++]=t/4294967296&255,r[i++]=t/16777216&255,r[i++]=t/65536&255,r[i++]=t/256&255,r[i++]=255&t,r[i++]=112|s>>>28&15,r[i++]=s>>>20&255,r[i++]=128|s>>>14&63,r[i++]=s>>>6&255,r[i++]=s<<2&255|3&e[10],r[i++]=e[11],r[i++]=e[12],r[i++]=e[13],r[i++]=e[14],r[i++]=e[15],r}t.updateV7State=o,t.default=function(e,t,s){let c;if(e)c=a(e.random??e.rng?.()??(0,r.default)(),e.msecs,e.seq,t,s);else{const e=Date.now(),i=(0,r.default)();o(n,e,i),c=a(i,n.msecs,n.seq,t,s)}return t??(0,i.unsafeStringify)(c)}},8873:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(3596);t.default=function(e){return"string"==typeof e&&r.default.test(e)}},9547:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(8873);t.default=function(e){if(!(0,r.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}}},t={};var s=function s(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,s),n.exports}(8156);module.exports=s})();