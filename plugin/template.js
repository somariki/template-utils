const{createApp,ref,reactive,watch,onMounted,onUnmounted}=Vue,uid="onecomme.plugin.template-utils",LIMIT=30,app=createApp({setup(){const e=new URLSearchParams(window.location.search),t=`${window.location.pathname}`.substring(1).split("/").slice(1,3).join("/")||null,o=reactive({baseURL:`${window.location.protocol}//${window.location.host}`,hostURL:["http://127.0.0.1:11180"],localURL:"http://localhost:11180",code:e.get("code")||"",isCustom:e.get("cus")||0,templatePath:t||"",presetId:e.get("preset")||0});let a=[];const n=e=>{if("fastRender"===e.key){const e=JSON.parse(localStorage.getItem("fastRender"));1==!!e?.templateId&&(e?.templateId??null)==t&&(e?.presetId??0)==o.presetId&&s(e.cssData)}};function s(e){a=[],e.forEach((e=>{const t=!!e?.flag?.isCss,o=!!e?.flag?.isJs;if(!0===t){const t=e.cssvar,o=e.value||"";document.documentElement.style.setProperty(t,o)}!0===o&&a.push({code:e.code,data:e.data})})),a.length>0&&window.dispatchEvent(new CustomEvent("presetDataUpdated",{detail:a}))}const c=ref([]);let d=new Map,r=0;return onMounted((async()=>{await(async()=>{try{const e=await fetch(`${o.baseURL}/api/plugins/${uid}?code=${o.code}&isCustom=${o.isCustom}&presetId=${o.presetId}&templateId=${o.templatePath}`,{method:"GET"}),{response:t}=await e.json();t&&t.data.preset&&s(t.data.preset),document.body.removeAttribute("hidden")}catch(e){console.error(e.message)}})(),window.addEventListener("storage",n),OneSDK.setup({commentLimit:30}),OneSDK.subscribe({action:"comments",callback:e=>{const t=new Map;e.forEach((e=>{const o=d.get(e.data.id);isNaN(o)?(e.commentIndex=r,t.set(e.data.id,r),r++):(e.commentIndex=o,t.set(e.data.id,o))})),d=t,c.value=e}}),OneSDK.connect()})),onUnmounted((()=>{window.removeEventListener("storage",n)})),{comments:c,getClassName:e=>e.commentIndex%2==0?"comment even":"comment odd",getStyle:e=>OneSDK.getCommentStyle(e),getRole:e=>e.data.isOwner?"role-owner":e.data.isModerator?"role-moderator":e.data.isMember?"role-member":"role-normal",getPaidtext:e=>e.data.colors?"box box-paidtext":"box"}}});OneSDK.ready().then((()=>{app.mount("#container")}));