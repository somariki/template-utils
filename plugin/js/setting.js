const{createApp,ref,reactive,watch,onBeforeMount,onMounted,onUnmounted,onBeforeUnmount,computed}=Vue,{useQuasar}=Quasar,uid="onecomme.plugin.template-utils",app=createApp({setup(){const e=useQuasar(),t=ref(!1),a=reactive({title:"Template Utils | Setting",baseURL:`${window.location.protocol}//${window.location.host}`,localURL:"http://localhost:11180",homeURL:`${window.location.protocol}//${window.location.host}/plugins/${uid}/`,appVersion:"1.0.0",pluginVersion:"2.0.0",pluginAuthor:"Soma"});let n={defaultLanguage:"en-US",filter:{enableFilter:!1,platformOpt:[{label:"YouTube",value:"youtube",color:"red"},{label:"Twitch",value:"twitch",color:"deep-purple"},{label:"Bilibili",value:"bilibili",color:"light-blue"}],platform:[],replaceText:"〇",replaceTarget:[]},datetime:{isAutoTimezone:!0,timeZone:null}};const o=reactive({...n});const i=Intl.supportedValuesOf("timeZone").map((e=>{const t=function(e){const t=new Intl.DateTimeFormat("en-US",{timeZone:e,hour:"numeric",hour12:!1}).formatToParts(new Date),a=parseInt(t.find((e=>"hour"===e.type)).value,10)-(new Date).getUTCHours();return a>=0?`UTC+${a}`:`UTC${a}`}(e);return{value:e,label:`${e.replace("_"," ")} (${t})`}})),l=reactive({timeZones:i,timeLocates:[{value:"en",label:"English"},{value:"ja",label:"日本語"},{value:"zh-cn",label:"简体中文"},{value:"zh-tw",label:"繁體中文"}],lg:[]}),r=ref(!1),s=reactive({currentPage:localStorage.getItem("settingPage")||"filter",currentPageTitle:""}),u=computed({get:()=>o.filter.replaceTarget.join("\n"),set(e){o.filter.replaceTarget=e.split("\n").map((e=>e.trim())).filter((e=>""!==e))}}),c=async t=>{f();let n={};"save-filter"===t&&(n={setting:o,transmit:"save-filter-setting"}),"save-datetime"===t&&(n={setting:o,transmit:"save-datetime-setting"});try{f();const t=await fetch(`${a.baseURL}/api/plugins/${uid}`,{method:"PUT",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}),{response:o}=await t.json();o?(w(),e.loadingBar.setDefaults({color:"teal"}),e.loadingBar.stop(),v("bottom","teal",l.lg.message.successChange)):(h(),v("bottom","red",l.lg.message.failChange))}catch(e){h(),v("top","red",l.lg.message.failChange)}},g=ref(!1),p={title:"title",prefix:null,content:"content",priBtnLabel:"OK",secBtnLabel:"Cancel",actionBtnLabel:"Ok",isPriBtn:!1,isSecBtn:!1,isAction:!1},d=reactive({...p}),m=ref(!1);function f(){e.loadingBar.setDefaults({color:"teal"}),e.loadingBar.start()}function h(){e.loadingBar.setDefaults({color:"red"}),e.loadingBar.stop()}function v(t,a,n){e.notify({message:n,color:a,position:t})}watch((()=>s.currentPage),((e,t)=>{localStorage.setItem("settingPage",e)})),watch((()=>o.filter.enableFilter),((e,t)=>{!1===e&&!0===t&&c("save-filter")})),watch((()=>o.datetime.isAutoTimezone),((e,t)=>{!0===e&&!1===t&&c("save-datetime")})),watch(g,(e=>{!1===e&&Object.assign(d,p)})),watch(m,(e=>{!0===e&&(g.value=!1,m.value=!1)}));const w=async()=>{try{const e=await fetch(`${a.baseURL}/api/plugins/${uid}?lang=true&setting=true&plugin=true`,{method:"GET"}),{response:i}=await e.json();if(n={...n,...i.data.setting},o.filter={...n.filter},o.datetime={...n.datetime},l.lg=i.data.uipackage,""==s.currentPageTitle){const e=s.currentPage;s.currentPageTitle=l.lg.menu[e]}a.pluginVersion=i.data.pluginVersion,a.pluginAuthor=i.data.pluginAuthor,a.appVersion=i.data.appInfo.version,t.value=!0,document.body.removeAttribute("hidden")}catch(e){}};return onMounted((()=>{w()})),{loaded:t,web:a,ui:l,setting:o,leftDrawerOpen:r,toggleLeftDrawer:()=>{r.value=!r.value},switchPage:(e,t)=>{s.currentPage=e,s.currentPageTitle=t},settingPage:s,isModal:g,modalDialog:d,modalConfirmation:m,filterTarget:u,saveSetting:c}}});app.use(Quasar,{config:{loading:!0,loadingBar:!0,notify:!0}}),Quasar.IconSet.set(Quasar.IconSet.fontawesomeV6),app.mount("#app");